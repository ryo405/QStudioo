<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QStudio</title>
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyAT4ke3vAhF561T5w_tVLJXb_fJ-gg6Ga0",
  authDomain: "qstudio-c3647.firebaseapp.com",
  projectId: "qstudio-c3647",
  storageBucket: "qstudio-c3647.firebasestorage.app",
  messagingSenderId: "333244083949",
  appId: "1:333244083949:web:a9d74fde2fec3a0d17e6e4",
  databaseURL: "https://qstudio-c3647-default-rtdb.asia-southeast1.firebasedatabase.app"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
const rtdb = firebase.database();
</script>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:ital,wght@0,300;0,400;0,500;1,400&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#09090f;--surface:#111118;--surface2:#181825;--surface3:#1f1f2e;
  --border:rgba(255,255,255,0.07);--border2:rgba(255,255,255,0.13);
  --accent:#7c6fff;--accent2:#ff6b8a;--accent3:#3dffa0;--accent4:#ffb347;
  --text:#eeeef8;--muted:#6060a0;--muted2:#9090c0;
  --sidebar:68px;--topbar:58px;
}
body.light{
  --bg:#f4f4fb;--surface:#ffffff;--surface2:#ebebf8;--surface3:#e0e0f0;
  --border:rgba(0,0,0,0.08);--border2:rgba(0,0,0,0.13);
  --text:#111118;--muted:#8888aa;--muted2:#666680;
}
*{margin:0;padding:0;box-sizing:border-box;}
html,body{height:100%;overflow:hidden;}
body{background:var(--bg);color:var(--text);font-family:'DM Sans',sans-serif;display:flex;flex-direction:column;}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ONBOARDING
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
#onboarding{
  position:fixed;inset:0;z-index:998;
  background:#09090f;
  display:none;flex-direction:column;
}
#onboarding.show{display:flex;}
.ob-slides{flex:1;position:relative;overflow:hidden;}
.ob-slide{
  position:absolute;inset:0;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  padding:40px 32px;gap:0;
  opacity:0;transform:translateX(60px);
  transition:opacity .35s ease, transform .35s ease;
  pointer-events:none;
}
.ob-slide.active{opacity:1;transform:translateX(0);pointer-events:all;}
.ob-slide.exit{opacity:0;transform:translateX(-60px);}
.ob-illus{
  width:220px;height:220px;border-radius:32px;margin-bottom:32px;
  display:flex;align-items:center;justify-content:center;font-size:80px;
  position:relative;flex-shrink:0;
}
.ob-illus::before{
  content:'';position:absolute;inset:-20px;border-radius:50%;
  background:radial-gradient(ellipse,rgba(124,111,255,.18),transparent 70%);
}
.ob-title{font-family:'Syne',sans-serif;font-size:26px;font-weight:800;text-align:center;line-height:1.2;margin-bottom:14px;}
.ob-desc{font-size:14px;color:var(--muted2);text-align:center;line-height:1.7;max-width:280px;}
.ob-bottom{padding:24px 28px 36px;display:flex;flex-direction:column;gap:16px;flex-shrink:0;}
.ob-dots{display:flex;align-items:center;justify-content:center;gap:7px;}
.ob-dot{width:7px;height:7px;border-radius:99px;background:var(--surface3);transition:all .3s;}
.ob-dot.active{width:22px;background:var(--accent);}
.ob-btns{display:flex;gap:10px;}
.ob-skip{flex:1;padding:14px;border-radius:13px;background:var(--surface2);border:1px solid var(--border);color:var(--muted2);font-family:'DM Sans',sans-serif;font-size:14px;cursor:pointer;transition:all .2s;}
.ob-skip:hover{color:var(--text);border-color:var(--border2);}
.ob-next{flex:2;padding:14px;border-radius:13px;background:linear-gradient(135deg,var(--accent),#9b94ff);border:none;color:#fff;font-family:'Syne',sans-serif;font-size:14px;font-weight:700;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:8px;}
.ob-next:hover{opacity:.88;transform:translateY(-1px);}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   AUTH (LOGIN / REGISTER)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
#authScreen{
  position:fixed;inset:0;z-index:997;
  background:#09090f;
  display:none;flex-direction:column;align-items:center;
  overflow-y:auto;
}
#authScreen.show{display:flex;}
.auth-wrap{width:100%;max-width:400px;padding:40px 28px 60px;display:flex;flex-direction:column;gap:0;}
.auth-logo-row{display:flex;align-items:center;justify-content:center;gap:12px;margin-bottom:36px;}
.auth-logo{width:48px;height:48px;border-radius:14px;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-size:22px;}
.auth-brand{font-family:'Syne',sans-serif;font-size:22px;font-weight:800;background:linear-gradient(90deg,#fff,var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
/* tabs */
.auth-tabs{display:flex;background:var(--surface2);border:1px solid var(--border);border-radius:13px;padding:4px;margin-bottom:28px;}
.auth-tab{flex:1;padding:10px;border-radius:10px;font-family:'Syne',sans-serif;font-size:13px;font-weight:700;text-align:center;cursor:pointer;color:var(--muted2);transition:all .2s;border:none;background:none;}
.auth-tab.active{background:var(--accent);color:#fff;}
/* forms */
.auth-form{display:flex;flex-direction:column;gap:14px;}
.auth-form.hidden{display:none;}
.auth-group{display:flex;flex-direction:column;gap:6px;}
.auth-label{font-size:11.5px;font-weight:600;color:var(--muted2);letter-spacing:.5px;}
.auth-input-wrap{position:relative;}
.auth-input{
  width:100%;background:var(--surface2);border:1px solid var(--border);
  border-radius:11px;color:var(--text);font-family:'DM Sans',sans-serif;
  font-size:14px;padding:12px 14px;outline:none;transition:border-color .2s;
}
.auth-input:focus{border-color:var(--accent);}
.auth-input::placeholder{color:var(--muted);}
.auth-eye{position:absolute;right:12px;top:50%;transform:translateY(-50%);background:none;border:none;color:var(--muted2);cursor:pointer;font-size:16px;transition:color .2s;}
.auth-eye:hover{color:var(--text);}
.auth-submit{
  background:linear-gradient(135deg,var(--accent),#9b94ff);
  color:#fff;border:none;border-radius:13px;padding:15px;
  font-family:'Syne',sans-serif;font-size:15px;font-weight:800;
  cursor:pointer;transition:all .2s;margin-top:4px;
  display:flex;align-items:center;justify-content:center;gap:8px;
}
.auth-submit:hover{opacity:.88;transform:translateY(-1px);}
.auth-submit.loading{opacity:.7;pointer-events:none;}
/* divider */
.auth-divider{display:flex;align-items:center;gap:12px;margin:4px 0;}
.auth-divider::before,.auth-divider::after{content:'';flex:1;height:1px;background:var(--border);}
.auth-divider span{font-size:11.5px;color:var(--muted);}
/* google btn */
.auth-google{
  width:100%;background:var(--surface2);border:1px solid var(--border2);
  border-radius:13px;padding:13px;
  font-family:'DM Sans',sans-serif;font-size:14px;font-weight:500;color:var(--text);
  cursor:pointer;transition:all .2s;
  display:flex;align-items:center;justify-content:center;gap:10px;
}
.auth-google:hover{border-color:var(--accent);background:var(--surface3);}
.auth-google-ico{width:20px;height:20px;}
.auth-err{background:rgba(255,107,138,.1);border:1px solid rgba(255,107,138,.3);border-radius:10px;padding:10px 13px;font-size:12.5px;color:var(--accent2);display:none;}
.auth-err.show{display:block;}
.auth-terms{font-size:11px;color:var(--muted);text-align:center;line-height:1.6;margin-top:4px;}
.auth-terms a{color:var(--muted2);text-decoration:underline;cursor:pointer;}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MAIN APP (hidden until logged in)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
#mainApp{display:none;flex-direction:column;height:100%;}
#mainApp.show{display:flex;}

/* ‚îÄ TOPBAR ‚îÄ */
.topbar{height:var(--topbar);flex-shrink:0;background:var(--surface);border-bottom:1px solid var(--border);display:flex;align-items:center;padding:0 18px;gap:12px;position:relative;z-index:20;}
.tl{display:flex;align-items:center;gap:10px;}
.tl-icon{width:34px;height:34px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-size:17px;flex-shrink:0;}
.tl-name{font-family:'Syne',sans-serif;font-weight:800;font-size:17px;background:linear-gradient(90deg,#fff,var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.tl-tag{font-family:'Syne',monospace;font-size:10px;background:var(--surface2);border:1px solid var(--border);border-radius:5px;padding:2px 7px;color:var(--muted2);letter-spacing:.5px;}
.t-space{flex:1;}
.t-search{background:var(--surface2);border:1px solid var(--border);border-radius:9px;display:flex;align-items:center;gap:7px;padding:0 12px;height:34px;width:200px;transition:border-color .2s;}
.t-search:focus-within{border-color:var(--accent);}
.t-search input{background:none;border:none;outline:none;color:var(--text);font-size:12px;font-family:'DM Sans',sans-serif;width:100%;}
.t-search input::placeholder{color:var(--muted);}
.t-btn{width:34px;height:34px;background:var(--surface2);border:1px solid var(--border);border-radius:9px;display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--muted2);transition:all .2s;position:relative;flex-shrink:0;}
.t-btn:hover{color:var(--text);border-color:var(--accent);}
.ndot{position:absolute;top:6px;right:6px;width:6px;height:6px;background:var(--accent2);border-radius:50%;border:1.5px solid var(--surface);display:none;}
.ndot.show{display:block;}
.t-avatar{width:34px;height:34px;border-radius:9px;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-family:'Syne',sans-serif;font-size:13px;font-weight:800;cursor:pointer;transition:opacity .2s;flex-shrink:0;overflow:hidden;}
.t-avatar:hover{opacity:.85;}
.t-avatar img{width:100%;height:100%;object-fit:cover;}

/* ‚îÄ LAYOUT ‚îÄ */
.layout{display:flex;flex:1;overflow:hidden;}

/* ‚îÄ SIDEBAR ‚îÄ */
.sidebar{width:var(--sidebar);flex-shrink:0;background:var(--surface);border-right:1px solid var(--border);display:flex;flex-direction:column;align-items:center;padding:14px 0;gap:4px;transition:width .25s ease,opacity .25s ease;}
.sidebar.collapsed{width:0;opacity:0;overflow:hidden;pointer-events:none;}
.sidebar-show-btn{position:fixed;left:0;top:50%;transform:translateY(-50%);z-index:100;background:linear-gradient(135deg,var(--accent),var(--accent2));border:none;border-radius:0 10px 10px 0;padding:12px 7px;cursor:pointer;display:none;color:#fff;box-shadow:3px 0 15px rgba(124,111,255,.4);}
.sidebar.collapsed ~ * .sidebar-show-btn, body.sb-hidden .sidebar-show-btn{display:flex;}
.nav-i{width:44px;height:44px;border-radius:13px;display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--muted);transition:all .2s;position:relative;background:none;border:none;}
.nav-i:hover{color:var(--text);background:var(--surface2);}
.nav-i.active{color:var(--text);background:linear-gradient(135deg,rgba(124,111,255,.18),rgba(255,107,138,.1));border:1px solid rgba(124,111,255,.3);}
.nav-i.active::before{content:'';position:absolute;left:-1px;top:50%;transform:translateY(-50%);width:3px;height:20px;background:var(--accent);border-radius:0 3px 3px 0;}
.nav-tip{position:absolute;left:54px;background:var(--surface3);border:1px solid var(--border2);border-radius:7px;padding:4px 10px;font-size:11.5px;color:var(--text);white-space:nowrap;pointer-events:none;opacity:0;transition:opacity .15s;z-index:99;}
.nav-i:hover .nav-tip{opacity:1;}
.sb-sep{width:28px;height:1px;background:var(--border);margin:4px 0;}
.sb-sp{flex:1;}
.nav-badge{position:absolute;top:5px;right:5px;width:8px;height:8px;background:var(--accent2);border-radius:50%;border:1.5px solid var(--surface);display:none;}
.nav-badge.show{display:block;}

/* ‚îÄ PAGES ‚îÄ */
.pages{flex:1;overflow:hidden;display:flex;position:relative;}
.page{display:none;width:100%;height:100%;overflow:hidden;flex-direction:column;}
.page.active{display:flex;}
.page-slide{animation:slideR .26s cubic-bezier(.4,0,.2,1) both;}
.page-slide-back{animation:slideL .26s cubic-bezier(.4,0,.2,1) both;}
@keyframes slideR{from{opacity:0;transform:translateX(28px)}to{opacity:1;transform:none}}
@keyframes slideL{from{opacity:0;transform:translateX(-28px)}to{opacity:1;transform:none}}
@keyframes spin{to{transform:rotate(360deg)}}
@keyframes fadeUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:none}}

/* ‚îÄ PAGE HEADER ‚îÄ */
.ph{display:flex;align-items:center;gap:12px;padding:13px 18px;border-bottom:1px solid var(--border);background:var(--surface);flex-shrink:0;}
.back-btn{width:34px;height:34px;border-radius:9px;background:var(--surface2);border:1px solid var(--border);display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--muted2);transition:all .2s;flex-shrink:0;}
.back-btn:hover{color:var(--text);border-color:var(--accent);}
.ph-info{flex:1;}
.ph-title{font-family:'Syne',sans-serif;font-weight:700;font-size:15.5px;}
.ph-sub{font-size:11.5px;color:var(--muted2);margin-top:1px;}
.ph-action{width:34px;height:34px;border-radius:9px;background:var(--surface2);border:1px solid var(--border);display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--muted2);transition:all .2s;}
.ph-action:hover{color:var(--text);border-color:var(--accent);}

/* ‚îÄ SCROLLABLE CONTENT ‚îÄ */
.scroll-content{flex:1;overflow-y:auto;scrollbar-width:thin;scrollbar-color:var(--surface3) transparent;}
::-webkit-scrollbar{width:4px;}::-webkit-scrollbar-track{background:transparent;}::-webkit-scrollbar-thumb{background:var(--surface3);border-radius:99px;}

/* ‚îÄ EMPTY STATE ‚îÄ */
.empty{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:300px;gap:10px;text-align:center;padding:40px 24px;animation:fadeUp .4s ease;}
.empty-ico{font-size:48px;opacity:.4;}
.empty-t{font-family:'Syne',sans-serif;font-size:17px;font-weight:800;color:var(--muted2);}
.empty-s{font-size:13px;color:var(--muted);line-height:1.65;max-width:240px;}
.empty-btn{margin-top:6px;background:linear-gradient(135deg,var(--accent),#9b94ff);color:#fff;border:none;border-radius:11px;padding:10px 22px;font-family:'Syne',sans-serif;font-size:13px;font-weight:700;cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:7px;}
.empty-btn:hover{opacity:.87;transform:translateY(-1px);}

/* HOME */
.home-wrap{padding:20px;}
.home-h{margin-bottom:16px;}
.home-title{font-family:'Syne',sans-serif;font-size:20px;font-weight:800;letter-spacing:-.3px;}
.home-sub{font-size:12px;color:var(--muted2);margin-top:2px;}
.stories{display:flex;gap:10px;margin-bottom:20px;overflow-x:auto;padding-bottom:2px;}
.stories::-webkit-scrollbar{display:none;}
.story{flex-shrink:0;display:flex;flex-direction:column;align-items:center;gap:5px;cursor:pointer;}
.story-ring{width:50px;height:50px;border-radius:50%;padding:2.5px;background:linear-gradient(135deg,var(--accent),var(--accent2));transition:transform .2s;}
.story-ring:hover{transform:scale(1.07);}
.story-inner{width:100%;height:100%;border-radius:50%;background:var(--surface2);display:flex;align-items:center;justify-content:center;border:2px solid var(--surface);font-size:17px;overflow:hidden;}
.story-inner img{width:100%;height:100%;object-fit:cover;border-radius:50%;}
.story-label{font-size:10px;color:var(--muted2);text-align:center;max-width:52px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.story-add .story-ring{background:var(--surface2);border:2px dashed rgba(124,111,255,.45);padding:0;}
.story-add .story-inner{background:transparent;border:none;font-size:19px;}
.story-add:hover .story-ring{border-color:var(--accent);}
.post-card{background:var(--surface);border:1px solid var(--border);border-radius:16px;overflow:hidden;animation:fadeUp .3s ease both;cursor:pointer;}
.post-card:hover{border-color:rgba(124,111,255,.3);}
.post-head{display:flex;align-items:center;gap:10px;padding:12px 14px 8px;}
.post-av{width:36px;height:36px;border-radius:10px;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-family:'Syne',sans-serif;font-weight:800;font-size:13px;color:#fff;overflow:hidden;}
.post-av img{width:100%;height:100%;object-fit:cover;}
.post-info{flex:1;min-width:0;}
.post-name{font-weight:600;font-size:13.5px;}
.post-cats{display:flex;gap:4px;margin-top:2px;flex-wrap:wrap;}
.post-cat{padding:1px 7px;border-radius:20px;font-size:10px;background:var(--surface3);border:1px solid var(--border);color:var(--muted2);}
.post-time{font-size:10.5px;color:var(--muted);flex-shrink:0;}
.post-img{width:100%;aspect-ratio:auto;max-height:480px;object-fit:contain;display:block;background:#000;}
.post-vid{width:100%;aspect-ratio:auto;max-height:480px;object-fit:contain;display:block;background:#000;}
.post-body{padding:10px 14px;}
.post-cap{font-size:13px;line-height:1.6;}
.post-link{display:inline-flex;align-items:center;gap:5px;background:var(--surface2);border:1px solid var(--border);border-radius:7px;padding:5px 10px;margin-top:7px;color:var(--muted2);font-size:11.5px;text-decoration:none;transition:all .2s;max-width:100%;overflow:hidden;}
.post-link:hover{color:var(--accent);border-color:var(--accent);}
.post-link span{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.post-dev{font-size:11px;color:var(--muted);margin-top:5px;}
.post-dev b{color:var(--accent2);}
.post-actions{display:flex;align-items:center;gap:2px;padding:7px 10px 10px;border-top:1px solid var(--border);}
.act-btn{display:flex;align-items:center;gap:4px;padding:5px 10px;border-radius:8px;background:none;border:none;cursor:pointer;color:var(--muted2);font-size:12px;font-family:'DM Sans',sans-serif;transition:all .2s;}
.act-btn:hover{background:var(--surface2);color:var(--text);}
.act-btn.liked{color:var(--accent2);}
.act-btn.liked svg{fill:var(--accent2);}
.act-sp{flex:1;}

/* UPLOAD */
.upload-wrap{padding:20px;display:flex;flex-direction:column;gap:14px;}
.up-dropzone{border:2px dashed rgba(124,111,255,.3);border-radius:16px;min-height:170px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:9px;cursor:pointer;background:radial-gradient(ellipse at 50% 100%,rgba(124,111,255,.06),transparent 70%);transition:all .3s;position:relative;overflow:hidden;}
.up-dropzone.over,.up-dropzone:hover{border-color:var(--accent);background:radial-gradient(ellipse at 50% 100%,rgba(124,111,255,.13),transparent 70%);}
.up-dropzone input[type=file]{position:absolute;inset:0;opacity:0;cursor:pointer;}
.dz-ico{font-size:30px;}
.dz-t{font-family:'Syne',sans-serif;font-size:14px;font-weight:700;}
.dz-s{font-size:11.5px;color:var(--muted2);text-align:center;}
.prev-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(88px,1fr));gap:8px;}
.prev-item{position:relative;aspect-ratio:1;border-radius:10px;overflow:hidden;background:var(--surface2);border:1px solid var(--border);}
.prev-item img,.prev-item video{width:100%;height:100%;object-fit:cover;}
.prev-rm{position:absolute;top:4px;right:4px;width:19px;height:19px;background:rgba(255,107,138,.9);border-radius:50%;border:none;color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:10px;}
.form-group{display:flex;flex-direction:column;gap:5px;}
.form-label{font-size:11px;font-weight:600;color:var(--muted2);text-transform:uppercase;letter-spacing:.7px;}
.form-input,.form-textarea{background:var(--surface2);border:1px solid var(--border);border-radius:10px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:13.5px;padding:10px 13px;outline:none;transition:border-color .2s;width:100%;}
.form-input:focus,.form-textarea:focus{border-color:var(--accent);}
.form-input::placeholder,.form-textarea::placeholder{color:var(--muted);}
.form-textarea{resize:vertical;min-height:74px;line-height:1.6;}
.cat-chips{display:flex;flex-wrap:wrap;gap:6px;}
.cat-chip{padding:5px 11px;border-radius:20px;background:var(--surface2);border:1px solid var(--border);cursor:pointer;font-size:12px;color:var(--muted2);transition:all .2s;}
.cat-chip:hover{border-color:var(--accent);color:var(--text);}
.cat-chip.sel{background:rgba(124,111,255,.18);border-color:var(--accent);color:var(--text);}
.submit-btn{background:linear-gradient(135deg,var(--accent),#9b94ff);color:#fff;border:none;border-radius:11px;padding:13px;font-family:'Syne',sans-serif;font-size:14px;font-weight:700;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:8px;}
.submit-btn:hover{opacity:.88;transform:translateY(-1px);}

/* CHAT LIST */
.cl-search{padding:10px 14px;border-bottom:1px solid var(--border);}
.cl-search-wrap{background:var(--surface2);border:1px solid var(--border);border-radius:9px;display:flex;align-items:center;gap:7px;padding:7px 11px;}
.cl-search-wrap input{background:none;border:none;outline:none;color:var(--text);font-family:'DM Sans',sans-serif;font-size:12.5px;width:100%;}
.cl-search-wrap input::placeholder{color:var(--muted);}
.chat-tabs{display:flex;padding:0 14px;border-bottom:1px solid var(--border);}
.chat-tab{flex:1;padding:9px 0;font-size:12px;font-weight:500;text-align:center;border-bottom:2px solid transparent;cursor:pointer;color:var(--muted);transition:all .2s;}
.chat-tab.active{color:var(--text);border-bottom-color:var(--accent);}
.chat-user-list{flex:1;overflow-y:auto;}
.chat-item{display:flex;align-items:center;gap:11px;padding:12px 14px;cursor:pointer;transition:background .15s;border-bottom:1px solid var(--border);}
.chat-item:hover{background:var(--surface2);}
.ci-av{width:44px;height:44px;border-radius:12px;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-family:'Syne',sans-serif;font-weight:800;font-size:15px;color:#fff;position:relative;overflow:hidden;}
.ci-av img{width:100%;height:100%;object-fit:cover;}
.ci-online{position:absolute;bottom:-2px;right:-2px;width:11px;height:11px;background:var(--accent3);border-radius:50%;border:2px solid var(--surface);}
.ci-info{flex:1;min-width:0;}
.ci-name{font-size:13.5px;font-weight:600;}
.ci-handle{font-size:11px;color:var(--muted2);margin-top:1px;}
.ci-prev{font-size:11.5px;color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-top:3px;}
.ci-meta{display:flex;flex-direction:column;align-items:flex-end;gap:4px;}
.ci-time{font-size:10px;color:var(--muted);}
.ci-badge{background:var(--accent);border-radius:20px;padding:2px 7px;font-size:10px;color:#fff;font-weight:700;}

/* CHAT ROOM */
.cr-head{display:flex;align-items:center;gap:10px;padding:11px 14px;border-bottom:1px solid var(--border);background:var(--surface);flex-shrink:0;}
.cr-av{width:38px;height:38px;border-radius:11px;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-family:'Syne',sans-serif;font-weight:800;font-size:14px;color:#fff;overflow:hidden;}
.cr-av img{width:100%;height:100%;object-fit:cover;}
.cr-name{font-weight:700;font-size:14px;}
.cr-status{font-size:11px;display:flex;align-items:center;gap:4px;margin-top:2px;}
.cr-dot{width:6px;height:6px;border-radius:50%;}
.cr-msgs{flex:1;overflow-y:auto;padding:14px;display:flex;flex-direction:column;gap:11px;}
.msg-row{display:flex;flex-direction:column;gap:2px;animation:fadeUp .22s ease;}
.msg-row.out{align-items:flex-end;}
.msg-bub{padding:8px 12px;border-radius:13px;font-size:13px;line-height:1.55;max-width:74%;}
.msg-row.in .msg-bub{background:var(--surface2);border:1px solid var(--border);border-bottom-left-radius:4px;}
.msg-row.out .msg-bub{background:linear-gradient(135deg,var(--accent),#9b94ff);color:#fff;border-bottom-right-radius:4px;}
.msg-time{font-size:10px;color:var(--muted);padding:0 4px;}
.msg-sender{font-size:10px;font-weight:600;color:var(--muted2);padding:0 4px;}
.day-sep{display:flex;align-items:center;gap:8px;margin:4px 0;}
.day-sep::before,.day-sep::after{content:'';flex:1;height:1px;background:var(--border);}
.day-sep span{font-size:10.5px;color:var(--muted);white-space:nowrap;}
.cr-input-area{padding:10px 13px;border-top:1px solid var(--border);background:var(--surface);flex-shrink:0;}
.cr-input-row{background:var(--surface2);border:1px solid var(--border);border-radius:12px;display:flex;align-items:flex-end;gap:7px;padding:8px 10px;transition:border-color .2s;}
.cr-input-row:focus-within{border-color:var(--accent);}
.cr-attach{background:none;border:none;color:var(--muted2);cursor:pointer;display:flex;align-items:center;transition:color .2s;padding:2px;}
.cr-attach:hover{color:var(--accent);}
.cr-text{flex:1;background:none;border:none;outline:none;color:var(--text);font-family:'DM Sans',sans-serif;font-size:13px;resize:none;max-height:80px;line-height:1.5;}
.cr-text::placeholder{color:var(--muted);}
.cr-send{width:28px;height:28px;background:linear-gradient(135deg,var(--accent),#9b94ff);border:none;border-radius:8px;cursor:pointer;display:flex;align-items:center;justify-content:center;color:#fff;transition:all .2s;}
.cr-send:hover{opacity:.85;transform:scale(1.05);}
.typing-ind{display:flex;align-items:center;gap:3px;padding:8px 12px;background:var(--surface2);border:1px solid var(--border);border-radius:13px;border-bottom-left-radius:4px;width:fit-content;}
.typing-dot{width:5px;height:5px;border-radius:50%;background:var(--muted2);animation:typeBounce 1.2s infinite ease;}
.typing-dot:nth-child(2){animation-delay:.2s;}.typing-dot:nth-child(3){animation-delay:.4s;}
@keyframes typeBounce{0%,60%,100%{transform:translateY(0)}30%{transform:translateY(-4px)}}

/* NOTIF */
.notif-sec-title{padding:12px 16px 6px;font-size:10.5px;font-weight:600;color:var(--muted);text-transform:uppercase;letter-spacing:.8px;}
.notif-item{display:flex;align-items:flex-start;gap:11px;padding:12px 16px;border-bottom:1px solid var(--border);cursor:pointer;transition:background .15s;position:relative;}
.notif-item:hover{background:var(--surface2);}
.notif-item.unread{background:rgba(124,111,255,.05);}
.notif-item.unread::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;background:var(--accent);border-radius:0 2px 2px 0;}
.ni-av{width:40px;height:40px;border-radius:11px;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-family:'Syne',sans-serif;font-weight:800;font-size:14px;color:#fff;position:relative;overflow:hidden;}
.ni-av img{width:100%;height:100%;object-fit:cover;}
.ni-badge{position:absolute;bottom:-3px;right:-3px;width:18px;height:18px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:9px;border:2px solid var(--surface);}
.ni-body{flex:1;min-width:0;}
.ni-text{font-size:12.5px;line-height:1.5;}
.ni-text strong{font-weight:600;}
.ni-time{font-size:10.5px;color:var(--muted);margin-top:3px;}
.ni-thumb{width:40px;height:40px;border-radius:8px;background:var(--surface2);flex-shrink:0;overflow:hidden;display:flex;align-items:center;justify-content:center;font-size:16px;}
.ni-thumb img{width:100%;height:100%;object-fit:cover;}

/* PROFILE */
.prof-banner{width:100%;height:170px;flex-shrink:0;position:relative;overflow:hidden;background:linear-gradient(135deg,#12002e,#0d1a3a 45%,#1a002e);}
.prof-banner::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse at 20% 60%,rgba(124,111,255,.42),transparent 55%),radial-gradient(ellipse at 80% 20%,rgba(255,107,138,.28),transparent 50%),radial-gradient(ellipse at 55% 85%,rgba(61,255,160,.12),transparent 45%);}
.prof-banner-btn{position:absolute;bottom:10px;right:10px;z-index:2;background:rgba(0,0,0,.45);backdrop-filter:blur(6px);border:1px solid rgba(255,255,255,.12);border-radius:8px;padding:5px 10px;font-size:11px;color:#fff;cursor:pointer;display:flex;align-items:center;gap:5px;}
.prof-banner-btn:hover{background:rgba(124,111,255,.4);}
.prof-av-row{display:flex;align-items:flex-end;justify-content:space-between;padding:0 18px;margin-top:-42px;position:relative;z-index:3;}
.prof-av-outer{width:84px;height:84px;border-radius:20px;background:linear-gradient(135deg,var(--accent),var(--accent2));padding:2.5px;border:3px solid var(--bg);cursor:pointer;transition:transform .2s;position:relative;flex-shrink:0;}
.prof-av-outer:hover{transform:scale(1.03);}
.prof-av-inner{width:100%;height:100%;border-radius:17px;background:linear-gradient(135deg,#5c30ff,#ff3d70);display:flex;align-items:center;justify-content:center;font-family:'Syne',sans-serif;font-size:26px;font-weight:800;color:#fff;overflow:hidden;}
.prof-av-inner img{width:100%;height:100%;object-fit:cover;}
.prof-av-cam{position:absolute;bottom:-4px;right:-4px;width:24px;height:24px;border-radius:50%;background:var(--accent);border:2px solid var(--bg);display:flex;align-items:center;justify-content:center;font-size:11px;}
.prof-edit-btn{background:var(--surface2);border:1px solid var(--border2);border-radius:10px;padding:7px 14px;font-family:'Syne',sans-serif;font-size:12px;font-weight:600;color:var(--text);cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:5px;margin-bottom:4px;}
.prof-edit-btn:hover{border-color:var(--accent);color:var(--accent);}
.prof-info{padding:12px 18px 0;}
.prof-name{font-family:'Syne',sans-serif;font-size:19px;font-weight:800;letter-spacing:-.3px;}
.prof-handle{font-size:12.5px;color:var(--muted2);margin-top:2px;}
.prof-badges{display:flex;gap:6px;flex-wrap:wrap;margin-top:6px;}
.prof-badge{padding:3px 10px;border-radius:20px;font-size:11px;background:rgba(124,111,255,.14);border:1px solid rgba(124,111,255,.28);color:#b0abff;}
.prof-bio{font-size:13px;color:var(--muted2);line-height:1.65;margin-top:9px;}
.prof-stats{display:grid;grid-template-columns:repeat(3,1fr);margin:14px 18px 0;background:var(--surface2);border:1px solid var(--border);border-radius:13px;overflow:hidden;}
.ps-item{padding:13px 0;text-align:center;border-right:1px solid var(--border);}
.ps-item:last-child{border-right:none;}
.ps-num{font-family:'Syne',sans-serif;font-size:18px;font-weight:800;background:linear-gradient(135deg,var(--text),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.ps-lbl{font-size:10px;color:var(--muted);margin-top:3px;}
.prof-grid-sec{padding:16px 18px 24px;}
.prof-grid-hdr{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;}
.prof-grid-title{font-family:'Syne',sans-serif;font-size:14px;font-weight:700;}
.view-toggle{display:flex;background:var(--surface2);border:1px solid var(--border);border-radius:9px;overflow:hidden;}
.vt-btn{width:34px;height:30px;display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--muted2);transition:all .2s;background:none;border:none;}
.vt-btn.active{background:var(--accent);color:#fff;}
.prof-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:3px;border-radius:11px;overflow:hidden;}
.pg-item{aspect-ratio:1;background:var(--surface2);overflow:hidden;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:opacity .2s;position:relative;}
.pg-item:hover{opacity:.76;}
.pg-item img,.pg-item video{width:100%;height:100%;object-fit:cover;display:block;}
.prof-list{display:flex;flex-direction:column;gap:10px;}
.pl-item{background:var(--surface);border:1px solid var(--border);border-radius:13px;overflow:hidden;cursor:pointer;display:flex;transition:border-color .2s;animation:fadeUp .3s ease both;}
.pl-item:hover{border-color:rgba(124,111,255,.3);}
.pl-thumb{width:80px;height:80px;flex-shrink:0;background:var(--surface2);overflow:hidden;display:flex;align-items:center;justify-content:center;font-size:20px;}
.pl-thumb img,.pl-thumb video{width:100%;height:100%;object-fit:cover;}
.pl-info{flex:1;padding:10px 12px;display:flex;flex-direction:column;justify-content:center;gap:3px;}
.pl-cap{font-size:13px;font-weight:500;line-height:1.4;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;}
.pl-meta{font-size:11px;color:var(--muted2);}

/* EDIT PROFILE */
.ep-wrap{padding:18px;display:flex;flex-direction:column;gap:14px;}
.ep-av-sec{display:flex;flex-direction:column;align-items:center;gap:8px;padding:18px;background:var(--surface2);border:1px solid var(--border);border-radius:14px;}
.ep-av{width:86px;height:86px;border-radius:20px;background:linear-gradient(135deg,#5c30ff,#ff3d70);display:flex;align-items:center;justify-content:center;font-family:'Syne',sans-serif;font-size:28px;font-weight:800;color:#fff;position:relative;cursor:pointer;overflow:hidden;transition:opacity .2s;}
.ep-av:hover{opacity:.88;}
.ep-av img{width:100%;height:100%;object-fit:cover;}
.ep-av-overlay{position:absolute;inset:0;background:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;font-size:20px;opacity:0;transition:opacity .2s;}
.ep-av:hover .ep-av-overlay{opacity:1;}
.ep-hint{font-size:12px;color:var(--muted2);}
.ep-sec-lbl{font-family:'Syne',sans-serif;font-size:11.5px;font-weight:700;color:var(--muted2);text-transform:uppercase;letter-spacing:.8px;}
.ep-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
.ep-group{display:flex;flex-direction:column;gap:5px;}
.ep-label{font-size:11.5px;font-weight:600;color:var(--muted2);}
.ep-input,.ep-textarea{background:var(--surface2);border:1px solid var(--border);border-radius:10px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:13.5px;padding:10px 12px;outline:none;transition:border-color .2s;width:100%;}
.ep-input:focus,.ep-textarea:focus{border-color:var(--accent);}
.ep-input::placeholder,.ep-textarea::placeholder{color:var(--muted);}
.ep-textarea{resize:vertical;min-height:74px;line-height:1.6;}
.ep-char{font-size:10.5px;color:var(--muted);text-align:right;margin-top:2px;}
.ep-save{background:linear-gradient(135deg,var(--accent),#9b94ff);color:#fff;border:none;border-radius:11px;padding:13px;font-family:'Syne',sans-serif;font-size:14px;font-weight:700;cursor:pointer;transition:all .2s;width:100%;}
.ep-save:hover{opacity:.88;transform:translateY(-1px);}
.ep-cancel{background:var(--surface2);border:1px solid var(--border);border-radius:11px;padding:11px;font-family:'DM Sans',sans-serif;font-size:13px;color:var(--muted2);cursor:pointer;transition:all .2s;width:100%;}
.ep-cancel:hover{color:var(--text);border-color:var(--border2);}

/* SETTINGS */
.settings-wrap{padding:18px;display:flex;flex-direction:column;gap:6px;}
.set-section{margin-bottom:8px;}
.set-sec-label{font-size:10.5px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.9px;padding:0 4px;margin-bottom:6px;}
.set-group{background:var(--surface2);border:1px solid var(--border);border-radius:13px;overflow:hidden;}
.set-item{display:flex;align-items:center;gap:12px;padding:13px 14px;border-bottom:1px solid var(--border);cursor:pointer;transition:background .15s;}
.set-item:last-child{border-bottom:none;}
.set-item:hover{background:rgba(124,111,255,.06);}
.set-icon{width:32px;height:32px;border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0;}
.set-label{flex:1;}
.set-name{font-size:13.5px;font-weight:500;}
.set-desc{font-size:11.5px;color:var(--muted2);margin-top:1px;}
.set-right{color:var(--muted);display:flex;align-items:center;gap:6px;}
.set-val{font-size:12px;color:var(--muted2);}
.toggle{width:38px;height:22px;background:var(--surface3);border-radius:11px;position:relative;cursor:pointer;transition:background .25s;flex-shrink:0;}
.toggle.on{background:var(--accent);}
.toggle::after{content:'';position:absolute;top:3px;left:3px;width:16px;height:16px;border-radius:50%;background:#fff;transition:transform .25s;box-shadow:0 1px 4px rgba(0,0,0,.3);}
.toggle.on::after{transform:translateX(16px);}
.set-about{text-align:center;padding:18px;color:var(--muted);font-size:11.5px;line-height:1.8;}
.set-about span{color:var(--muted2);}
.soc-group{background:var(--surface2);border:1px solid var(--border);border-radius:13px;overflow:hidden;}
.soc-item{display:flex;align-items:center;gap:12px;padding:13px 14px;border-bottom:1px solid var(--border);cursor:pointer;transition:background .15s;text-decoration:none;color:var(--text);}
.soc-item:last-child{border-bottom:none;}
.soc-item:hover{background:rgba(124,111,255,.07);}
.soc-logo{width:36px;height:36px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0;}
.soc-info{flex:1;}
.soc-name{font-size:13.5px;font-weight:600;}
.soc-handle{font-size:11.5px;color:var(--muted2);margin-top:1px;}
.soc-arrow{color:var(--muted);}

/* BOTTOM SHEET */
.bs-overlay{position:fixed;inset:0;background:rgba(0,0,0,0);z-index:100;pointer-events:none;transition:background .3s;}
.bs-overlay.open{background:rgba(0,0,0,.65);pointer-events:all;}
.bs-sheet{position:fixed;bottom:0;left:var(--sidebar);right:0;background:var(--surface);border-radius:20px 20px 0 0;border:1px solid var(--border2);border-bottom:none;z-index:101;transform:translateY(100%);transition:transform .32s cubic-bezier(.4,0,.2,1);max-height:85vh;display:flex;flex-direction:column;}
.bs-sheet.open{transform:translateY(0);}
.bs-handle{width:36px;height:4px;background:var(--border2);border-radius:99px;margin:12px auto 0;}
.bs-content{padding:16px 18px 24px;overflow-y:auto;display:flex;flex-direction:column;gap:14px;}
.bs-media{width:100%;max-height:260px;object-fit:cover;border-radius:12px;display:block;}
.bs-media-vid{width:100%;max-height:260px;border-radius:12px;display:block;}
.bs-info{display:flex;flex-direction:column;gap:8px;}
.bs-cap{font-size:14px;line-height:1.6;}
.bs-meta-row{display:flex;align-items:center;gap:8px;}
.bs-av{width:32px;height:32px;border-radius:9px;display:flex;align-items:center;justify-content:center;font-family:'Syne',sans-serif;font-size:12px;font-weight:800;color:#fff;overflow:hidden;flex-shrink:0;}
.bs-av img{width:100%;height:100%;object-fit:cover;}
.bs-user{font-size:13px;font-weight:600;}
.bs-dev{font-size:11.5px;color:var(--muted2);}
.bs-cats{display:flex;flex-wrap:wrap;gap:5px;}
.bs-cat{padding:3px 9px;border-radius:20px;font-size:11px;background:var(--surface2);border:1px solid var(--border);color:var(--muted2);}
.bs-actions{display:grid;grid-template-columns:1fr 1fr;gap:8px;}
.bs-action-btn{display:flex;align-items:center;justify-content:center;gap:7px;padding:11px;border-radius:11px;font-family:'Syne',sans-serif;font-size:13px;font-weight:600;cursor:pointer;transition:all .2s;border:none;}
.bs-action-btn.primary{background:linear-gradient(135deg,var(--accent),#9b94ff);color:#fff;}
.bs-action-btn.primary:hover{opacity:.88;}
.bs-action-btn.ghost{background:var(--surface2);border:1px solid var(--border);color:var(--muted2);}
.bs-action-btn.ghost:hover{color:var(--text);border-color:var(--accent);}
.bs-link{display:flex;align-items:center;gap:8px;background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:10px 12px;text-decoration:none;color:var(--muted2);transition:all .2s;}
.bs-link:hover{color:var(--accent);border-color:var(--accent);}
.bs-link span{flex:1;font-size:12.5px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}

/* VERSION BADGE */
.version-badge{position:fixed;bottom:14px;right:14px;z-index:50;background:var(--surface2);border:1px solid var(--border2);border-radius:8px;padding:3px 8px;display:flex;flex-direction:column;align-items:flex-end;gap:0;pointer-events:none;opacity:0.7;}
.vb-name{font-family:'Syne',sans-serif;font-size:9px;font-weight:800;background:linear-gradient(90deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.vb-by{font-size:8px;color:var(--muted);}

/* COMMENTS */
.cmt-overlay{position:fixed;inset:0;background:rgba(0,0,0,.65);z-index:110;opacity:0;pointer-events:none;transition:opacity .3s;}
.cmt-overlay.open{opacity:1;pointer-events:all;}
.cmt-sheet{position:fixed;bottom:0;left:0;right:0;background:var(--surface);border-radius:20px 20px 0 0;border:1px solid var(--border2);border-bottom:none;z-index:111;transform:translateY(100%);transition:transform .32s cubic-bezier(.4,0,.2,1);max-height:80vh;display:flex;flex-direction:column;}
.cmt-sheet.open{transform:translateY(0);}
.cmt-handle{width:36px;height:4px;background:var(--border2);border-radius:99px;margin:12px auto 0;flex-shrink:0;}
.cmt-head{display:flex;align-items:center;justify-content:space-between;padding:14px 18px 10px;border-bottom:1px solid var(--border);flex-shrink:0;}
.cmt-title{font-family:'Syne',sans-serif;font-weight:700;font-size:15px;}
.cmt-close{background:none;border:none;color:var(--muted2);cursor:pointer;font-size:18px;line-height:1;}
.cmt-list{flex:1;overflow-y:auto;padding:12px 16px;display:flex;flex-direction:column;gap:14px;}
.cmt-empty{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:160px;gap:8px;color:var(--muted);}
.cmt-empty-ico{font-size:36px;opacity:.4;}
.cmt-empty-t{font-size:13px;}
.cmt-item{display:flex;gap:10px;animation:fadeUp .2s ease;}
.cmt-av{width:34px;height:34px;border-radius:10px;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-family:'Syne',sans-serif;font-weight:800;font-size:12px;color:#fff;background:linear-gradient(135deg,var(--accent),var(--accent2));overflow:hidden;}
.cmt-av img{width:100%;height:100%;object-fit:cover;}
.cmt-body{flex:1;}
.cmt-name{font-size:12.5px;font-weight:700;margin-bottom:3px;}
.cmt-text{font-size:13px;line-height:1.55;color:var(--text);}
.cmt-time{font-size:10.5px;color:var(--muted);margin-top:3px;}
.cmt-input-area{padding:10px 14px 20px;border-top:1px solid var(--border);flex-shrink:0;}
.cmt-input-row{background:var(--surface2);border:1px solid var(--border);border-radius:12px;display:flex;align-items:center;gap:8px;padding:8px 10px;transition:border-color .2s;}
.cmt-input-row:focus-within{border-color:var(--accent);}
.cmt-av-small{width:28px;height:28px;border-radius:8px;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-family:'Syne',sans-serif;font-weight:800;font-size:10px;color:#fff;background:linear-gradient(135deg,var(--accent),var(--accent2));overflow:hidden;}
.cmt-av-small img{width:100%;height:100%;object-fit:cover;}
.cmt-inp{flex:1;background:none;border:none;outline:none;color:var(--text);font-family:'DM Sans',sans-serif;font-size:13px;}
.cmt-inp::placeholder{color:var(--muted);}
.cmt-send{width:30px;height:30px;background:linear-gradient(135deg,var(--accent),#9b94ff);border:none;border-radius:8px;cursor:pointer;display:flex;align-items:center;justify-content:center;color:#fff;transition:all .2s;flex-shrink:0;}
.cmt-send:hover{opacity:.85;}

/* BADGES */
.badge{display:inline-flex;align-items:center;justify-content:center;border-radius:50%;margin-left:3px;vertical-align:middle;}
.badge.owner{background:linear-gradient(135deg,#1d9bf0,#7c6fff);color:#fff;width:16px;height:16px;font-size:9px;font-weight:900;box-shadow:0 0 6px rgba(29,155,240,.4);}
.badge.verified{background:linear-gradient(135deg,#1d9bf0,#7c6fff);color:#fff;width:15px;height:15px;font-size:9px;font-weight:900;}

/* PULL TO REFRESH */
.ptr-indicator{position:fixed;top:0;left:50%;transform:translateX(-50%);background:var(--surface2);border:1px solid var(--border);border-radius:99px;padding:6px 14px;font-size:12px;color:var(--muted2);z-index:200;transition:all .3s;opacity:0;pointer-events:none;margin-top:-40px;}
.ptr-indicator.show{opacity:1;margin-top:12px;}

/* TOAST */
.toast{position:fixed;bottom:18px;right:18px;z-index:200;background:var(--surface2);border:1px solid var(--border2);border-radius:10px;padding:10px 15px;font-size:13px;display:flex;align-items:center;gap:7px;box-shadow:0 8px 28px rgba(0,0,0,.4);animation:toastIn .25s ease;pointer-events:none;}
@keyframes toastIn{from{opacity:0;transform:translateY(8px) scale(.96)}to{opacity:1;transform:none}}
.toast.out{animation:toastOut .22s ease forwards;}
@keyframes toastOut{to{opacity:0;transform:translateY(6px) scale(.96)}}
</style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ONBOARDING ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="onboarding">
  <div class="ob-slides">
    <!-- Slide 1 -->
    <div class="ob-slide active" id="ob0">
      <div class="ob-illus">üé¨</div>
      <div class="ob-title">Selamat Datang di QStudio</div>
      <div class="ob-desc">Platform kreatif untuk berbagi karya, konten, dan ide terbaik kamu bersama komunitas.</div>
    </div>
    <!-- Slide 2 -->
    <div class="ob-slide" id="ob1">
      <div class="ob-illus">üöÄ</div>
      <div class="ob-title">Post & Ekspresikan Dirimu</div>
      <div class="ob-desc">Upload foto, video, dan project kamu. Dari desain, kode, musik, sampai animasi ‚Äî semua bisa!</div>
    </div>
    <!-- Slide 3 -->
    <div class="ob-slide" id="ob2">
      <div class="ob-illus">üí¨</div>
      <div class="ob-title">Terhubung & Berkolaborasi</div>
      <div class="ob-desc">Chat, like, dan komentar bareng kreator lain. Bangun jaringan dan kolaborasi keren bersama Qyro.</div>
    </div>
  </div>
  <div class="ob-bottom">
    <div class="ob-dots">
      <div class="ob-dot active" id="dot0"></div>
      <div class="ob-dot" id="dot1"></div>
      <div class="ob-dot" id="dot2"></div>
    </div>
    <div class="ob-btns">
      <button class="ob-skip" onclick="skipOnboarding()">Lewati</button>
      <button class="ob-next" id="obNextBtn" onclick="obNext()">
        Selanjutnya
        <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="m9 18 6-6-6-6"/></svg>
      </button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê AUTH ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="authScreen">
  <div class="auth-wrap">
    <div class="auth-logo-row">
      <div class="auth-logo">üé¨</div>
      <span class="auth-brand">QStudio</span>
    </div>
    <div class="auth-tabs">
      <button class="auth-tab active" id="tabLogin" onclick="switchAuth('login')">Masuk</button>
      <button class="auth-tab" id="tabRegis" onclick="switchAuth('register')">Daftar</button>
    </div>

    <!-- LOGIN FORM -->
    <div class="auth-form" id="loginForm">
      <div class="auth-err" id="loginErr"></div>
      <div class="auth-group">
        <label class="auth-label">Email</label>
        <input class="auth-input" id="loginEmail" type="email" placeholder="email@kamu.com">
      </div>
      <div class="auth-group">
        <label class="auth-label">Password</label>
        <div class="auth-input-wrap">
          <input class="auth-input" id="loginPass" type="password" placeholder="Kata sandi" style="padding-right:42px">
          <button class="auth-eye" onclick="togglePw('loginPass',this)">üëÅÔ∏è</button>
        </div>
      </div>
      <button class="auth-submit" id="loginBtn" onclick="doLogin()">
        <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg>
        Masuk
      </button>
      <div class="auth-divider"><span>atau</span></div>
      <button class="auth-google" onclick="doGoogle()">
        <svg class="auth-google-ico" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
        Lanjutkan dengan Google
      </button>
    </div>

    <!-- REGISTER FORM -->
    <div class="auth-form hidden" id="registerForm">
      <div class="auth-err" id="regisErr"></div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
        <div class="auth-group">
          <label class="auth-label">Nama Depan</label>
          <input class="auth-input" id="regFirst" type="text" placeholder="Nama depan">
        </div>
        <div class="auth-group">
          <label class="auth-label">Nama Belakang</label>
          <input class="auth-input" id="regLast" type="text" placeholder="Nama belakang">
        </div>
      </div>
      <div class="auth-group">
        <label class="auth-label">Username</label>
        <input class="auth-input" id="regUser" type="text" placeholder="@username" oninput="fmtUserAuth(this)">
      </div>
      <div class="auth-group">
        <label class="auth-label">Email</label>
        <input class="auth-input" id="regEmail" type="email" placeholder="email@kamu.com">
      </div>
      <div class="auth-group">
        <label class="auth-label">Password</label>
        <div class="auth-input-wrap">
          <input class="auth-input" id="regPass" type="password" placeholder="Min. 6 karakter" style="padding-right:42px">
          <button class="auth-eye" onclick="togglePw('regPass',this)">üëÅÔ∏è</button>
        </div>
      </div>
      <button class="auth-submit" id="regisBtn" onclick="doRegister()">
        <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="19" y1="8" x2="19" y2="14"/><line x1="22" y1="11" x2="16" y2="11"/></svg>
        Buat Akun
      </button>
      <div class="auth-divider"><span>atau</span></div>
      <button class="auth-google" onclick="doGoogle()">
        <svg class="auth-google-ico" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
        Lanjutkan dengan Google
      </button>
      <div class="auth-terms">Dengan mendaftar, kamu setuju dengan <a>Syarat & Ketentuan</a> dan <a>Kebijakan Privasi</a> QStudio.</div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MAIN APP ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="mainApp">
<button class="sidebar-show-btn" id="sidebarShowBtn" onclick="toggleSidebar()">
  <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg>
</button>
<header class="topbar">
  <div class="tl">
    <div class="tl-icon">üé¨</div>
    <span class="tl-name">QStudio</span>
    <span class="tl-tag">&lt;/&gt;</span>
  </div>
  <div class="t-space"></div>
  <div class="t-search">
    <svg width="13" height="13" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
    <input placeholder="Cari post, user..." id="searchInput" oninput="doSearch(this.value)">
  </div>
  <button class="t-btn" onclick="goPage('notif','forward')">
    <svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
    <span class="ndot" id="notifDot"></span>
  </button>
  <div class="t-avatar" id="topAvatar" onclick="goPage('profile','forward')">Q</div>
</header>

<div class="layout">
  <nav class="sidebar" id="mainSidebar">
    <button class="nav-i" id="sidebarToggleBtn" onclick="toggleSidebar()" style="background:linear-gradient(135deg,var(--accent),var(--accent2));border-radius:10px;color:#fff;margin-bottom:4px;" title="Sembunyikan sidebar">
      <svg id="sidebarToggleIcon" width="15" height="15" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><polyline points="15 18 9 12 15 6"/></svg>
    </button>
    <button class="nav-i active" id="nav-home" onclick="goPage('home','back')">
      <svg width="19" height="19" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
      <span class="nav-tip">Home</span>
    </button>
    <button class="nav-i" id="nav-upload" onclick="goPage('upload','forward')">
      <svg width="19" height="19" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="3"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>
      <span class="nav-tip">Buat Post</span>
    </button>
    <button class="nav-i" id="nav-chat" onclick="goPage('chat','forward')">
      <svg width="19" height="19" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
      <span class="nav-tip">Chat</span>
    </button>
    <div class="sb-sep"></div>
    <button class="nav-i" id="nav-notif" onclick="goPage('notif','forward')">
      <svg width="19" height="19" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
      <span class="nav-tip">Notifikasi</span>
      <span class="nav-badge" id="notifNb"></span>
    </button>
    <button class="nav-i" id="nav-profile" onclick="goPage('profile','forward')">
      <svg width="19" height="19" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
      <span class="nav-tip">Profil</span>
    </button>
    <div class="sb-sp"></div>
    <button class="nav-i" id="nav-settings" onclick="goPage('settings','forward')">
      <svg width="19" height="19" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
      <span class="nav-tip">Pengaturan</span>
    </button>

    <div style="flex:1"></div>

    <!-- Tombol Back to Top -->
    <button class="nav-i" onclick="scrollToTop()" title="Ke atas" style="opacity:0.6">
      <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><polyline points="18 15 12 9 6 15"/></svg>
      <span class="nav-tip">Ke atas</span>
    </button>

    <!-- Tombol Random Post -->
    <button class="nav-i" onclick="openRandomPost()" title="Post acak" style="opacity:0.6">
      <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><polyline points="16 3 21 3 21 8"/><line x1="4" y1="20" x2="21" y2="3"/><polyline points="21 16 21 21 16 21"/><line x1="15" y1="15" x2="21" y2="21"/></svg>
      <span class="nav-tip">Acak</span>
    </button>
  </nav>

  <div class="pages">
    <!-- HOME -->
    <div class="page active" id="page-home">
      <div class="scroll-content" id="homeScroll">
        <div class="home-wrap">
          <div class="home-h">
            <div>
              <div class="home-title" id="homeGreet">Beranda</div>
              <div class="home-sub">Konten terbaru dari komunitas QStudio</div>
            </div>
            <button onclick="refreshFeed(this)" style="background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:7px 10px;color:var(--muted2);cursor:pointer;display:flex;align-items:center;gap:5px;font-size:12px;font-family:'DM Sans',sans-serif;">
              <svg id="refreshIcon" width="13" height="13" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
              Refresh
            </button>
          </div>
          <div class="stories" id="storiesRow">
            <div class="story story-add" onclick="goPage('upload','forward')">
              <div class="story-ring"><div class="story-inner">+</div></div>
              <span class="story-label">Post</span>
            </div>
          </div>
          <div id="feedContainer"></div>
        </div>
      </div>
    </div>

    <div class="ptr-indicator" id="ptrIndicator">Merefresh feed...</div>

    <!-- UPLOAD -->
    <div class="page" id="page-upload">
      <div class="ph">
        <button class="back-btn" onclick="goBack()"><svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="m15 18-6-6 6-6"/></svg></button>
        <div class="ph-info"><div class="ph-title">Buat Post Baru</div><div class="ph-sub">Bagikan karya & kontenmu</div></div>
      </div>
      <div class="scroll-content">
        <div class="upload-wrap">
          <!-- MEDIA URL INPUT -->
          <div class="form-group">
            <label class="form-label">Thumbnail / Gambar Preview</label>
            <div style="display:flex;gap:8px;align-items:center">
              <input class="form-input" id="imgUrlInput" placeholder="Link gambar thumbnail (imgbb, imgur...)" oninput="previewImgUrl(this.value)" style="flex:1">
              <button onclick="addImgUrl()" style="background:linear-gradient(135deg,var(--accent),var(--accent2));border:none;border-radius:10px;color:#fff;padding:9px 14px;font-size:12px;font-family:'DM Sans',sans-serif;cursor:pointer;white-space:nowrap;font-weight:600">+ Tambah</button>
            </div>
            <div id="imgUrlPreview" style="margin-top:10px;display:none">
              <img id="imgUrlPreviewImg" style="width:100%;max-height:200px;object-fit:contain;border-radius:10px;background:#111;border:1px solid var(--border)">
              <video id="imgUrlPreviewVid" style="width:100%;max-height:200px;border-radius:10px;display:none" controls></video>
              <div style="font-size:11px;color:var(--accent3);margin-top:4px">Preview media</div>
            </div>
            <div style="margin-top:6px;font-size:11px;color:var(--muted)">
              Upload thumbnail ke <a href="https://imgbb.com" target="_blank" style="color:var(--accent)">imgbb.com</a> ‚Üí Direct link
            </div>
          </div>
          <div class="prev-grid" id="prevGrid"></div>

          <!-- DOWNLOAD LINK -->
          <div class="form-group">
            <label class="form-label">Link Download / File (opsional)</label>
            <input class="form-input" id="downloadInput" placeholder="https://mediafire.com/... atau link file lainnya">
            <div style="margin-top:6px;font-size:11px;color:var(--muted)">Link Mediafire, Google Drive, dll. Akan muncul sebagai tombol Download di post</div>
          </div>

          <!-- TUTORIAL LINK -->
          <div class="form-group">
            <label class="form-label">Link Tutorial / Demo (opsional)</label>
            <input class="form-input" id="tutorialInput" placeholder="https://youtube.com/...">
          </div>
          <div class="form-group"><label class="form-label">üìù Caption</label><textarea class="form-textarea" id="capInput" placeholder="Tulis caption..."></textarea></div>
          <div class="form-group"><label class="form-label">üë§ Kreator / Developer</label><input class="form-input" id="devInput" placeholder="@nama_kamu"></div>
          <div class="form-group"><label class="form-label">üîó Link (opsional)</label><input class="form-input" id="linkInput" placeholder="https://..."></div>
          <div class="form-group">
            <label class="form-label">üè∑Ô∏è Kategori</label>
            <div class="cat-chips">
              <div class="cat-chip" onclick="toggleCat(this)" data-cat="youtube">‚ñ∂ YouTube</div>
              <div class="cat-chip" onclick="toggleCat(this)" data-cat="roblox">üéÆ Roblox</div>
              <div class="cat-chip" onclick="toggleCat(this)" data-cat="prisma3d">üíé Prisma3D</div>
              <div class="cat-chip" onclick="toggleCat(this)" data-cat="design">üé® Design</div>
              <div class="cat-chip" onclick="toggleCat(this)" data-cat="code">üíª Code</div>
              <div class="cat-chip" onclick="toggleCat(this)" data-cat="music">üéµ Music</div>
              <div class="cat-chip" onclick="toggleCat(this)" data-cat="film">üé¨ Film</div>
              <div class="cat-chip" onclick="toggleCat(this)" data-cat="art">üñºÔ∏è Art</div>
              <div class="cat-chip" onclick="toggleCat(this)" data-cat="other">‚ú® Lainnya</div>
            </div>
          </div>
          <button class="submit-btn" onclick="submitPost()">
            <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
            Posting Sekarang
          </button>
        </div>
      </div>
    </div>

    <!-- CHAT LIST -->
    <div class="page" id="page-chat">
      <div class="ph">
        <button class="back-btn" onclick="goBack()"><svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="m15 18-6-6 6-6"/></svg></button>
        <div class="ph-info"><div class="ph-title">üí¨ Pesan</div><div class="ph-sub" id="onlineCountTxt"></div></div>
      </div>
      <div class="cl-search"><div class="cl-search-wrap"><svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg><input placeholder="Cari..." oninput="filterChats(this.value)"></div></div>
      <div class="chat-tabs">
        <div class="chat-tab active" onclick="switchTab(this)">Semua</div>
        <div class="chat-tab" onclick="switchTab(this)">Online</div>
        <div class="chat-tab" onclick="switchTab(this)">Belum dibaca</div>
      </div>
      <div class="chat-user-list" id="chatUserList">
        <div class="empty"><div class="empty-ico">üí¨</div><div class="empty-t">Belum ada percakapan</div><div class="empty-s">Chat real-time akan aktif setelah terhubung ke Firebase.</div></div>
      </div>
    </div>

    <!-- CHAT ROOM -->
    <div class="page" id="page-chatroom">
      <div class="cr-head">
        <button class="back-btn" onclick="goBack()"><svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="m15 18-6-6 6-6"/></svg></button>
        <div class="cr-av" id="crAv">?</div>
        <div style="flex:1;">
          <div class="cr-name" id="crName">‚Äî</div>
          <div class="cr-status"><div class="cr-dot" id="crDot"></div><span id="crStatusTxt">‚Äî</span></div>
        </div>
      </div>
      <div class="cr-msgs" id="crMsgs"></div>
      <div class="cr-input-area">
        <div class="cr-input-row">
          <button class="cr-attach" onclick="toast('üìé Attach coming soon!')"><svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/></svg></button>
          <textarea class="cr-text" id="crInput" rows="1" placeholder="Ketik pesan..."></textarea>
          <button class="cr-send" onclick="sendMsg()"><svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg></button>
        </div>
      </div>
    </div>

    <!-- NOTIF -->
    <div class="page" id="page-notif">
      <div class="ph">
        <button class="back-btn" onclick="goBack()"><svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="m15 18-6-6 6-6"/></svg></button>
        <div class="ph-info"><div class="ph-title">üîî Notifikasi</div><div class="ph-sub" id="notifSubTxt">Semua sudah dibaca</div></div>
        <button class="ph-action" style="font-size:11px;width:auto;padding:0 10px;color:var(--accent);border-color:transparent;background:none;" onclick="markAllRead()">Baca semua</button>
      </div>
      <div class="scroll-content"><div id="notifList"></div></div>
    </div>

    <!-- PROFILE -->
    <div class="page" id="page-profile">
      <div class="ph">
        <button class="back-btn" onclick="goBack()"><svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="m15 18-6-6 6-6"/></svg></button>
        <div class="ph-info"><div class="ph-title">Profil Saya</div></div>
        <button class="ph-action" onclick="goPage('settings','forward')"><svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14M4.93 4.93a10 10 0 0 0 0 14.14"/></svg></button>
      </div>
      <div class="scroll-content">
        <div class="prof-banner">
          <button class="prof-banner-btn"><svg width="11" height="11" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg> Ganti cover</button>
        </div>
        <div class="prof-av-row">
          <div class="prof-av-outer" onclick="goPage('editprofile','forward')">
            <div class="prof-av-inner" id="profAvInner">üë§</div>
            <div class="prof-av-cam">üì∑</div>
          </div>
          <button class="prof-edit-btn" onclick="goPage('editprofile','forward')">
            <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
            Edit Profil
          </button>
        </div>
        <div class="prof-info">
          <div class="prof-name" id="profName">Pengguna Baru</div>
          <div class="prof-handle" id="profHandle">@username</div>
          <div class="prof-badges" id="profBadges"><span class="prof-badge">Member</span></div>
          <div class="prof-bio" id="profBio">Belum ada bio. Edit profil untuk menambahkan.</div>
        </div>
        <div class="prof-stats">
          <div class="ps-item"><div class="ps-num" id="statPosts">0</div><div class="ps-lbl">Post</div></div>
          <div class="ps-item"><div class="ps-num">0</div><div class="ps-lbl">Followers</div></div>
          <div class="ps-item"><div class="ps-num">0</div><div class="ps-lbl">Following</div></div>
        </div>
        <div class="prof-grid-sec">
          <div class="prof-grid-hdr">
            <div class="prof-grid-title">Post Saya</div>
            <div class="view-toggle">
              <button class="vt-btn active" id="vtGrid" onclick="setView('grid')">
                <svg width="13" height="13" fill="currentColor" viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
              </button>
              <button class="vt-btn" id="vtList" onclick="setView('list')">
                <svg width="13" height="13" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>
              </button>
            </div>
          </div>
          <div id="profPostsWrap"></div>
        </div>
      </div>
    </div>

    <!-- EDIT PROFILE -->
    <div class="page" id="page-editprofile">
      <div class="ph">
        <button class="back-btn" onclick="goBack()"><svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="m15 18-6-6 6-6"/></svg></button>
        <div class="ph-info"><div class="ph-title">Edit Profil</div><div class="ph-sub">Ubah info & foto</div></div>
      </div>
      <div class="scroll-content">
        <div class="ep-wrap">
          <div class="ep-av-sec">
            <div class="ep-av" id="epAvEl" onclick="document.getElementById('epAvInput').click()">
              <div class="ep-av-overlay">üì∑</div>
            </div>
            <input type="file" id="epAvInput" accept="image/*" style="display:none" onchange="handleAvChange(this)">
            <div class="ep-hint">Ketuk foto untuk mengganti</div>
          </div>
          <div class="ep-sec-lbl">Info Publik</div>
          <div class="ep-row">
            <div class="ep-group"><label class="ep-label">Nama Depan *</label><input class="ep-input" id="epFirst" placeholder="Nama depan" maxlength="30"></div>
            <div class="ep-group"><label class="ep-label">Nama Belakang</label><input class="ep-input" id="epLast" placeholder="Nama belakang" maxlength="30"></div>
          </div>
          <div class="ep-group"><label class="ep-label">Username</label><input class="ep-input" id="epUser" placeholder="@username" maxlength="30" oninput="fmtUser(this)"></div>
          <div class="ep-group">
            <label class="ep-label">Bio</label>
            <textarea class="ep-textarea" id="epBio" placeholder="Ceritain tentang dirimu..." maxlength="150" oninput="document.getElementById('epBioCount').textContent=this.value.length"></textarea>
            <div class="ep-char"><span id="epBioCount">0</span>/150</div>
          </div>
          <div class="ep-group"><label class="ep-label">Lokasi</label><input class="ep-input" id="epLoc" placeholder="Kota, Negara"></div>
          <div class="ep-group"><label class="ep-label">Website / Link</label><input class="ep-input" id="epWeb" placeholder="https://..."></div>
          <button class="ep-save" onclick="saveProfile()">‚ú¶ Simpan Perubahan</button>
          <button class="ep-cancel" onclick="goBack()">Batal</button>
        </div>
      </div>
    </div>

    <!-- SETTINGS -->
    <div class="page" id="page-settings">
      <div class="ph">
        <button class="back-btn" onclick="goBack()"><svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="m15 18-6-6 6-6"/></svg></button>
        <div class="ph-info"><div class="ph-title">‚öôÔ∏è Pengaturan</div></div>
      </div>
      <div class="scroll-content">
        <div class="settings-wrap">
          <div class="set-section">
            <div class="set-sec-label">Akun</div>
            <div class="set-group">
              <div class="set-item" onclick="goPage('editprofile','forward')">
                <div class="set-icon" style="background:rgba(124,111,255,.15)">üë§</div>
                <div class="set-label"><div class="set-name">Edit Profil</div><div class="set-desc">Nama, bio, foto, username</div></div>
                <div class="set-right"><svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="m9 18 6-6-6-6"/></svg></div>
              </div>
              <div class="set-item" onclick="doLogout()">
                <div class="set-icon" style="background:rgba(255,107,138,.15)">üö™</div>
                <div class="set-label"><div class="set-name" style="color:var(--accent2)">Keluar</div><div class="set-desc">Logout dari akun ini</div></div>
                <div class="set-right"><svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="m9 18 6-6-6-6"/></svg></div>
              </div>
            </div>
          </div>
          <div class="set-section">
            <div class="set-sec-label">Notifikasi</div>
            <div class="set-group">
              <div class="set-item"><div class="set-icon" style="background:rgba(255,179,71,.15)">üîî</div><div class="set-label"><div class="set-name">Push Notification</div><div class="set-desc">Notifikasi dari aktivitas</div></div><div class="toggle on" onclick="toggleSwitch(this)"></div></div>
              <div class="set-item"><div class="set-icon" style="background:rgba(124,111,255,.15)">üí¨</div><div class="set-label"><div class="set-name">Notif Chat</div><div class="set-desc">Pesan masuk baru</div></div><div class="toggle on" onclick="toggleSwitch(this)"></div></div>
              <div class="set-item"><div class="set-icon" style="background:rgba(255,107,138,.15)">‚ù§Ô∏è</div><div class="set-label"><div class="set-name">Notif Like & Komen</div><div class="set-desc">Aktivitas di postmu</div></div><div class="toggle on" onclick="toggleSwitch(this)"></div></div>
            </div>
          </div>
          <div class="set-section">
            <div class="set-sec-label">Tampilan</div>
            <div class="set-group">
              <div class="set-item"><div class="set-icon" style="background:rgba(61,255,160,.15)" id="themeIcon">üåô</div><div class="set-label"><div class="set-name" id="themeLabel">Mode Gelap</div><div class="set-desc">Tap untuk ganti tema</div></div><div class="toggle on" id="themeToggle" onclick="toggleTheme(this)"></div></div>
            </div>
          </div>
          <div class="set-section">
            <div class="set-sec-label">üîó Link & Komunitas</div>
            <div class="soc-group">
              <a class="soc-item" href="https://wa.me/grouplink" target="_blank"><div class="soc-logo" style="background:linear-gradient(135deg,#25d366,#128c7e)">üí¨</div><div class="soc-info"><div class="soc-name">WhatsApp</div><div class="soc-handle">Grup Komunitas QStudio</div></div><div class="soc-arrow"><svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="m9 18 6-6-6-6"/></svg></div></a>
              <a class="soc-item" href="https://tiktok.com/@akunmu" target="_blank"><div class="soc-logo" style="background:linear-gradient(135deg,#010101,#69c9d0)">üéµ</div><div class="soc-info"><div class="soc-name">TikTok</div><div class="soc-handle">@akunmu</div></div><div class="soc-arrow"><svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="m9 18 6-6-6-6"/></svg></div></a>
              <a class="soc-item" href="https://youtube.com/@channelmu" target="_blank"><div class="soc-logo" style="background:linear-gradient(135deg,#ff0000,#cc0000)">‚ñ∂</div><div class="soc-info"><div class="soc-name">YouTube</div><div class="soc-handle">@channelmu</div></div><div class="soc-arrow"><svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="m9 18 6-6-6-6"/></svg></div></a>
              <a class="soc-item" href="https://discord.gg/servermu" target="_blank"><div class="soc-logo" style="background:linear-gradient(135deg,#5865f2,#7289da)">üéÆ</div><div class="soc-info"><div class="soc-name">Discord</div><div class="soc-handle">Server QStudio</div></div><div class="soc-arrow"><svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="m9 18 6-6-6-6"/></svg></div></a>
            </div>
          </div>
          <div class="set-about">QStudio v1.5<br><span>Download Link, Thumbnail Terpisah</span><br><span style="color:var(--muted)">By Ryo ¬∑ Qyro ¬∑ 2025</span></div>
        </div>
      </div>
    </div>
  </div>
</div>
</div><!-- /mainApp -->

<!-- BOTTOM SHEET -->
<div class="bs-overlay" id="bsOverlay" onclick="closeBS()"></div>
<div class="bs-sheet" id="bsSheet">
  <div class="bs-handle"></div>
  <div class="bs-content" id="bsContent"></div>
</div>

<!-- COMMENT SHEET -->
<div class="cmt-overlay" id="cmtOverlay" onclick="closeComments()"></div>
<div class="cmt-sheet" id="cmtSheet">
  <div class="cmt-handle"></div>
  <div class="cmt-head">
    <div class="cmt-title">Komentar</div>
    <button class="cmt-close" onclick="closeComments()">‚úï</button>
  </div>
  <div class="cmt-list" id="cmtList"></div>
  <div class="cmt-input-area">
    <div class="cmt-input-row">
      <div class="cmt-av-small" id="cmtMyAv">Q</div>
      <input class="cmt-inp" id="cmtInput" placeholder="Tulis komentar...">
      <button class="cmt-send" onclick="sendComment()">
        <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
      </button>
    </div>
  </div>
</div>

<!-- USER PROFILE MODAL -->
<div class="cmt-overlay" id="uprofOverlay" onclick="closeUserProfile()"></div>
<div class="cmt-sheet" id="uprofSheet" style="max-height:80vh">
  <div class="cmt-handle"></div>
  <div id="uprofContent" style="padding:20px;overflow-y:auto;max-height:70vh"></div>
</div>

<!-- VERSION BADGE -->
<div class="version-badge">
  <span class="vb-name">QStudio v1.5</span>
  <span class="vb-by">By Ryo ¬∑ Qyro</span>
</div>

<script>
/* ‚ïê‚ïê STATE ‚ïê‚ïê */
const S = {
  posts:[], files:[], cats:[], chatId:null, view:'grid',
  history:['home'],
  profile:{ first:'', last:'', user:'', bio:'', loc:'', web:'', avUrl:null },
  notifs:[],
  auth:null,
  onlineUsers:{},
};
const catE = {youtube:'‚ñ∂',roblox:'üéÆ',prisma3d:'üíé',design:'üé®',code:'üíª',music:'üéµ',film:'üé¨',art:'üñºÔ∏è',other:'‚ú®'};

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   INIT ‚Äî langsung cek auth tanpa splash
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
auth.onAuthStateChanged(user => {
  if(user){
    S.auth = user;
    loadUserProfile(user.uid).then(()=>{
      document.getElementById('onboarding').classList.remove('show');
      document.getElementById('authScreen').classList.remove('show');
      showApp();
    });
  } else {
    const seenOb = localStorage.getItem('qs_ob');
    if(seenOb){ showAuth(); }
    else { document.getElementById('onboarding').classList.add('show'); }
  }
});
async function loadUserProfile(uid){
  try {
    const doc = await db.collection('users').doc(uid).get();
    if(doc.exists){
      const data = doc.data();
      S.profile = {...S.profile, ...data};
    } else {
      // New user ‚Äî set default from auth
      const u = auth.currentUser;
      const name = u.displayName || u.email.split('@')[0];
      S.profile.first = name.split(' ')[0];
      S.profile.last = name.split(' ').slice(1).join(' ');
      S.profile.avUrl = u.photoURL || null;
      await db.collection('users').doc(uid).set({
        first: S.profile.first, last: S.profile.last,
        user: S.profile.first.toLowerCase(), bio:'', loc:'', web:'',
        avUrl: S.profile.avUrl || '', email: u.email,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });
    }
  } catch(e){ console.log('Profile load error:', e); }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ONBOARDING
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let obCurrent = 0;
const OB_TOTAL = 3;

function obNext(){
  if(obCurrent < OB_TOTAL-1){
    const cur = document.getElementById('ob'+obCurrent);
    cur.classList.add('exit');
    obCurrent++;
    const nxt = document.getElementById('ob'+obCurrent);
    nxt.classList.add('active');
    setTimeout(()=>{ cur.classList.remove('active','exit'); }, 400);
    document.querySelectorAll('.ob-dot').forEach((d,i)=>d.classList.toggle('active',i===obCurrent));
    if(obCurrent === OB_TOTAL-1){
      document.getElementById('obNextBtn').innerHTML = 'Mulai Sekarang <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="m9 18 6-6-6-6"/></svg>';
    }
  } else {
    skipOnboarding();
  }
}

function skipOnboarding(){
  localStorage.setItem('qs_ob','1');
  document.getElementById('onboarding').classList.remove('show');
  showAuth();
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   AUTH
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function showAuth(){ document.getElementById('authScreen').classList.add('show'); }

function switchAuth(tab){
  document.getElementById('tabLogin').classList.toggle('active', tab==='login');
  document.getElementById('tabRegis').classList.toggle('active', tab==='register');
  document.getElementById('loginForm').classList.toggle('hidden', tab!=='login');
  document.getElementById('registerForm').classList.toggle('hidden', tab!=='register');
}

function togglePw(id, btn){
  const inp = document.getElementById(id);
  if(inp.type==='password'){ inp.type='text'; btn.textContent='üôà'; }
  else { inp.type='password'; btn.textContent='üëÅÔ∏è'; }
}

function fmtUserAuth(inp){
  let v=inp.value.replace(/[^a-zA-Z0-9_.]/g,'');
  inp.value=v;
}

function showAuthErr(id, msg){
  const el=document.getElementById(id);
  el.textContent=msg; el.classList.add('show');
  setTimeout(()=>el.classList.remove('show'),4000);
}

async function doLogin(){
  const email=document.getElementById('loginEmail').value.trim();
  const pass=document.getElementById('loginPass').value;
  if(!email||!pass){ showAuthErr('loginErr','‚ö†Ô∏è Isi email dan password dulu!'); return; }
  const btn=document.getElementById('loginBtn');
  btn.classList.add('loading'); btn.textContent='Masuk...';
  try {
    await auth.signInWithEmailAndPassword(email, pass);
    // onAuthStateChanged will handle the rest
  } catch(e){
    btn.classList.remove('loading');
    btn.innerHTML='<svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg> Masuk';
    const msg = e.code==='auth/user-not-found'?'‚ö†Ô∏è Akun tidak ditemukan!':e.code==='auth/wrong-password'?'‚ö†Ô∏è Password salah!':'‚ö†Ô∏è '+e.message;
    showAuthErr('loginErr', msg);
  }
}

async function doRegister(){
  const first=document.getElementById('regFirst').value.trim();
  const email=document.getElementById('regEmail').value.trim();
  const pass=document.getElementById('regPass').value;
  if(!first){ showAuthErr('regisErr','‚ö†Ô∏è Nama depan wajib diisi!'); return; }
  if(!email||!email.includes('@')){ showAuthErr('regisErr','‚ö†Ô∏è Format email tidak valid!'); return; }
  if(pass.length<6){ showAuthErr('regisErr','‚ö†Ô∏è Password minimal 6 karakter!'); return; }
  const btn=document.getElementById('regisBtn');
  btn.classList.add('loading'); btn.textContent='Membuat akun...';
  try {
    const cred = await auth.createUserWithEmailAndPassword(email, pass);
    const last=document.getElementById('regLast').value.trim();
    const username=document.getElementById('regUser').value.trim()||first.toLowerCase();
    await cred.user.updateProfile({ displayName: first+' '+last });
    await db.collection('users').doc(cred.user.uid).set({
      first, last, user:username, bio:'', loc:'', web:'', avUrl:'', email,
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });
    // onAuthStateChanged will handle the rest
  } catch(e){
    btn.classList.remove('loading');
    btn.innerHTML='Buat Akun';
    const msg = e.code==='auth/email-already-in-use'?'‚ö†Ô∏è Email sudah dipakai!':'‚ö†Ô∏è '+e.message;
    showAuthErr('regisErr', msg);
  }
}

async function doGoogle(){
  try {
    const provider = new firebase.auth.GoogleAuthProvider();
    await auth.signInWithPopup(provider);
    // onAuthStateChanged will handle the rest
  } catch(e){
    toast('‚ö†Ô∏è Google login gagal: '+e.message);
  }
}

async function doLogout(){
  if(!confirm('Yakin mau keluar?')) return;
  // Set offline status
  if(S.auth){
    await rtdb.ref('online/'+S.auth.uid).remove();
  }
  await auth.signOut();
  S.auth=null;
  S.profile={first:'',last:'',user:'',bio:'',loc:'',web:'',avUrl:null};
  S.posts=[];
  document.getElementById('mainApp').classList.remove('show');
  document.getElementById('mainApp').style.display='none';
  showAuth();
  toast('üëã Berhasil keluar!');
}

function showApp(){
  // Set online status
  if(S.auth){
    const onlineRef = rtdb.ref('online/'+S.auth.uid);
    onlineRef.set({ uid: S.auth.uid, name: [S.profile.first,S.profile.last].filter(Boolean).join(' ')||'User', ts: Date.now() });
    onlineRef.onDisconnect().remove();
  }
  const app=document.getElementById('mainApp');
  app.style.display='flex';
  setTimeout(()=>app.classList.add('show'),10);
  loadPosts();
  renderNotifs();
  renderProfile();
  const hour=new Date().getHours();
  const greet=hour<11?'üåÖ Selamat Pagi':hour<15?'‚òÄÔ∏è Selamat Siang':hour<18?'üå§Ô∏è Selamat Sore':'üåô Selamat Malam';
  const name=S.profile.first||'Sobat';
  document.getElementById('homeGreet').textContent=greet+', '+name+'!';
  // Listen online users - auto refresh chat
  rtdb.ref('online').on('value', snap=>{
    S.onlineUsers = snap.val()||{};
    // refresh chat list kalau lagi di halaman chat
    const chatPage = document.getElementById('pgChat');
    if(chatPage && chatPage.classList.contains('active')){
      renderChatList();
    }
  });
}

/* ‚ïê‚ïê NAV ‚ïê‚ïê */
const navMap={home:'nav-home',upload:'nav-upload',chat:'nav-chat',chatroom:'nav-chat',notif:'nav-notif',profile:'nav-profile',editprofile:'nav-profile',settings:'nav-settings'};

function goPage(page,dir='forward'){
  const cur=document.querySelector('.page.active'), nxt=document.getElementById('page-'+page);
  if(!nxt||cur===nxt) return;
  cur.classList.remove('active'); nxt.classList.add('active');
  nxt.classList.remove('page-slide','page-slide-back'); void nxt.offsetWidth;
  nxt.classList.add(dir==='forward'?'page-slide':'page-slide-back');
  if(dir==='forward') S.history.push(page);
  document.querySelectorAll('.nav-i').forEach(b=>b.classList.remove('active'));
  if(navMap[page]) document.getElementById(navMap[page])?.classList.add('active');
  ({home:renderFeed,chat:()=>renderChatList(),notif:renderNotifs,profile:renderProfile,editprofile:loadEP,settings:()=>{}})[page]?.();
}

function goBack(){
  if(S.history.length<=1){goPage('home','back');S.history=['home'];return;}
  S.history.pop();
  const prev=S.history[S.history.length-1];
  const cur=document.querySelector('.page.active'), nxt=document.getElementById('page-'+prev);
  if(!nxt||cur===nxt) return;
  cur.classList.remove('active'); nxt.classList.add('active');
  nxt.classList.remove('page-slide','page-slide-back'); void nxt.offsetWidth; nxt.classList.add('page-slide-back');
  document.querySelectorAll('.nav-i').forEach(b=>b.classList.remove('active'));
  if(navMap[prev]) document.getElementById(navMap[prev])?.classList.add('active');
  ({home:renderFeed,notif:renderNotifs,profile:renderProfile})[prev]?.();
}

/* ‚ïê‚ïê FEED ‚Äî Firestore ‚ïê‚ïê */
function loadPosts(){
  db.collection('posts').orderBy('createdAt','desc').limit(30)
    .onSnapshot(snap=>{
      S.posts = snap.docs.map(d=>({id:d.id,...d.data()}));
      renderFeed();
    });
}

function renderFeed(){
  const fc=document.getElementById('feedContainer'), sr=document.getElementById('storiesRow');
  sr.querySelectorAll('.story:not(.story-add)').forEach(s=>s.remove());
  const seen = new Set();
  S.posts.forEach(p=>{
    if(seen.has(p.uid)) return; seen.add(p.uid);
    const s=document.createElement('div'); s.className='story';
    const avHTML=p.avUrl?`<img src="${p.avUrl}">`:`<span style="font-family:'Syne',sans-serif;font-size:13px;font-weight:800;color:#fff">${p.av||'?'}</span>`;
    s.innerHTML=`<div class="story-ring" style="background:${p.avUrl?'none':p.bg||'var(--accent)'}"><div class="story-inner">${avHTML}</div></div><span class="story-label">${(p.name||'User').split(' ')[0]}</span>`;
    sr.appendChild(s);
  });

  // Filter by search
  let posts = S.posts;
  if(searchQuery){
    posts = posts.filter(p=>
      (p.cap||'').toLowerCase().includes(searchQuery)||
      (p.name||'').toLowerCase().includes(searchQuery)||
      (p.dev||'').toLowerCase().includes(searchQuery)||
      (p.cats||[]).some(c=>c.toLowerCase().includes(searchQuery))
    );
  }

  if(posts.length===0){
    fc.innerHTML=searchQuery
      ? `<div class="empty"><div class="empty-ico">üîç</div><div class="empty-t">Tidak ada hasil untuk "${searchQuery}"</div></div>`
      : `<div class="empty"><div class="empty-ico">üåå</div><div class="empty-t">Feed masih kosong</div><div class="empty-s">Belum ada yang posting nih. Jadilah yang pertama!</div><button class="empty-btn" onclick="goPage('upload','forward')"><svg width="13" height="13" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="3"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>Buat Post Pertama</button></div>`;
    return;
  }
  const uid = S.auth?.uid;
  fc.innerHTML=posts.map((p,i)=>{
    const avHTML=p.avUrl?`<img src="${p.avUrl}">`:(p.av||'?');
    const media=(p.files||[]).map(f=>f.type&&f.type.startsWith('video')
      ?`<video class="post-vid" src="${f.url}" controls></video>`
      :`<img class="post-img" src="${f.url}" onerror="this.style.display='none';this.nextElementSibling.style.display='flex'" loading="lazy"><div style="display:none;align-items:center;justify-content:center;background:var(--surface2);border-radius:10px;padding:20px;gap:10px;flex-direction:column;color:var(--muted2);font-size:12px"><svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="3"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>Gambar tidak bisa ditampilkan<a href="${f.url}" target="_blank" style="color:var(--accent);font-size:11px">Buka link</a></div>`
    ).join('');
    const cats=(p.cats||[]).map(c=>`<span class="post-cat">${catE[c]||'‚ú®'} ${c}</span>`).join('');
    const lnk=p.link?`<a class="post-link" href="${p.link}" target="_blank"><svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg><span>${p.link}</span></a>`:'';
    const tut=p.tutorial?`<a class="post-link" href="${p.tutorial}" target="_blank" style="color:var(--accent2);border-color:rgba(255,107,138,.3)"><svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><polygon points="10 8 16 12 10 16 10 8"/></svg><span>Tutorial / Demo</span></a>`:'';
    const dl=p.download?`<a class="post-link" href="${p.download}" target="_blank" style="color:var(--accent3);border-color:rgba(61,255,160,.25);background:rgba(61,255,160,.07)"><svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg><span>Download File</span></a>`:'';
    const dev=p.dev?`<div class="post-dev">by <b>${p.dev}</b></div>`:'';
    const liked=(p.likedBy||[]).includes(uid);
    const likesCount=(p.likedBy||[]).length;
    const commentsCount=(p.commentsCount||0);
    return `<div class="post-card" style="animation-delay:${i*.05}s" onclick="openBS('${p.id}')">
      <div class="post-head" onclick="event.stopPropagation()">
        <div class="post-av" style="background:${p.avUrl?'none':p.bg||'var(--accent)'}">${avHTML}</div>
        <div class="post-info"><div class="post-name" onclick="event.stopPropagation();viewUserProfile('${p.uid}','${(p.name||'User').replace(/'/g,'')}','${p.avUrl||''}')" style="cursor:pointer;text-decoration:underline dotted">${p.name||'User'}${getBadge(p.uid)}</div><div class="post-cats">${cats}</div></div>
        <div class="post-time">${p.timeStr||''}</div>
      </div>
      ${media?`<div>${media}</div>`:''}
      <div class="post-body">${p.cap?`<div class="post-cap">${p.cap}</div>`:''}${dl}${tut}${lnk}${dev}</div>
      <div class="post-actions" onclick="event.stopPropagation()">
        <button class="act-btn ${liked?'liked':''}" onclick="toggleLike('${p.id}',this)">
          <svg width="13" height="13" fill="${liked?'currentColor':'none'}" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
          <span>${likesCount}</span>
        </button>
        <button class="act-btn" onclick="event.stopPropagation();openComments('${p.id}')">
          <svg width="13" height="13" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
          <span>${commentsCount}</span>
        </button>
        ${(uid===p.uid||isOwner(uid))?`<button class="act-btn" style="margin-left:auto;color:#ff4d4d" onclick="event.stopPropagation();deletePost('${p.id}')">
          <svg width="13" height="13" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14H6L5 6"/><path d="M10 11v6M14 11v6"/><path d="M9 6V4h6v2"/></svg>
          Hapus
        </button>`:''}
      </div>
    </div>`;
  }).join('');
}

async function toggleLike(id, btn){
  if(!S.auth){ toast('‚ö†Ô∏è Login dulu!'); return; }
  const uid = S.auth.uid;
  const ref = db.collection('posts').doc(id);
  const post = S.posts.find(p=>p.id===id); if(!post) return;
  const liked = (post.likedBy||[]).includes(uid);
  await ref.update({
    likedBy: liked
      ? firebase.firestore.FieldValue.arrayRemove(uid)
      : firebase.firestore.FieldValue.arrayUnion(uid)
  });
}

/* ‚ïê‚ïê BOTTOM SHEET ‚ïê‚ïê */
function openBS(id){
  const p=S.posts.find(p=>p.id===id); if(!p) return;
  const uid=S.auth?.uid;
  const avHTML=p.avUrl?`<img src="${p.avUrl}">`:(p.av||'?');
  const media=(p.files||[]).length?(p.files[0].type&&p.files[0].type.startsWith('video')?`<video class="bs-media-vid" src="${p.files[0].url}" controls></video>`:`<img class="bs-media" src="${p.files[0].url}">`):'';
  const cats=(p.cats||[]).map(c=>`<span class="bs-cat">${catE[c]||'‚ú®'} ${c}</span>`).join('');
  const lnk=p.link?`<a class="bs-link" href="${p.link}" target="_blank"><svg width="13" height="13" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg><span>${p.link}</span></a>`:'';
  const liked=(p.likedBy||[]).includes(uid);
  document.getElementById('bsContent').innerHTML=`
    ${media}
    <div class="bs-info">
      ${p.cap?`<div class="bs-cap">${p.cap}</div>`:''}
      <div class="bs-meta-row">
        <div class="bs-av" style="background:${p.avUrl?'none':p.bg||'var(--accent)'}">${avHTML}</div>
        <div><div class="bs-user">${p.name||'User'}</div>${p.dev?`<div class="bs-dev">by ${p.dev}</div>`:''}</div>
        <div style="font-size:11px;color:var(--muted);margin-left:auto">${p.timeStr||''}</div>
      </div>
      ${cats?`<div class="bs-cats">${cats}</div>`:''}${lnk}
    </div>
    <div class="bs-actions">
      <button class="bs-action-btn primary" onclick="toggleLike('${p.id}');closeBS()">‚ù§Ô∏è Suka (${(p.likedBy||[]).length})</button>
      <button class="bs-action-btn ghost" onclick="closeBS();openComments('${p.id}')">üí¨ Komentar (${p.commentsCount||0})</button>
      <button class="bs-action-btn ghost" onclick="closeBS();toast('üö© Dilaporkan!')">üö© Laporkan</button>
    </div>`;
  document.getElementById('bsOverlay').classList.add('open');
  document.getElementById('bsSheet').classList.add('open');
}
function closeBS(){document.getElementById('bsOverlay').classList.remove('open');document.getElementById('bsSheet').classList.remove('open');}

/* ‚ïê‚ïê UPLOAD ‚Äî URL based ‚ïê‚ïê */
S.mediaUrls = []; // array of {url, type}

function previewImgUrl(val){
  const preview = document.getElementById('imgUrlPreview');
  const img = document.getElementById('imgUrlPreviewImg');
  const vid = document.getElementById('imgUrlPreviewVid');
  if(!val){ preview.style.display='none'; return; }
  const isVideo = val.match(/\.(mp4|mov|webm|avi)$/i) || val.includes('streamable') || val.includes('youtube');
  if(isVideo){
    img.style.display='none';
    vid.style.display='block';
    vid.src = val;
    preview.style.display='block';
  } else {
    vid.style.display='none';
    img.style.display='block';
    img.src = val;
    img.onerror = ()=>{ preview.style.display='none'; };
    img.onload = ()=>{ preview.style.display='block'; };
  }
}

function addImgUrl(){
  const inp = document.getElementById('imgUrlInput');
  const url = inp.value.trim();
  if(!url){ toast('Paste link gambar dulu!'); return; }
  const isVideo = url.match(/\.(mp4|mov|webm|avi)$/i);
  S.mediaUrls.push({ url, type: isVideo ? 'video/mp4' : 'image/jpeg' });
  addPrevUrl(url, isVideo, S.mediaUrls.length-1);
  inp.value='';
  document.getElementById('imgUrlPreview').style.display='none';
  toast('Gambar ditambahkan!');
}

function addPrevUrl(url, isVideo, idx){
  const g = document.getElementById('prevGrid');
  const d = document.createElement('div'); d.className='prev-item'; d.id='prev-'+idx;
  d.innerHTML = isVideo
    ? `<video src="${url}" muted></video>`
    : `<img src="${url}" onerror="this.parentElement.style.opacity=0.4">`;
  const rm = document.createElement('button'); rm.className='prev-rm'; rm.innerHTML='‚úï';
  rm.onclick=()=>{ S.mediaUrls.splice(idx,1); d.remove(); };
  d.appendChild(rm); g.appendChild(d);
}

async function submitPost(){
  if(!S.auth){ toast('Login dulu!'); return; }
  const cap=document.getElementById('capInput').value.trim();
  const dev=document.getElementById('devInput').value.trim();
  const link=document.getElementById('linkInput').value.trim();
  const tutorial=document.getElementById('tutorialInput').value.trim();
  const download=document.getElementById('downloadInput').value.trim();
  if(!cap && S.mediaUrls.length===0){ toast('Isi caption atau tambah gambar dulu!'); return; }

  const btn=document.querySelector('.submit-btn');
  btn.textContent='Memposting...'; btn.disabled=true;

  try {
    const prof=S.profile;
    const name=[prof.first,prof.last].filter(Boolean).join(' ')||'Pengguna';
    const initials=name.split(' ').map(w=>w[0]).join('').slice(0,2).toUpperCase()||'?';
    const now = new Date();

    const isOwnerUser = isOwner(S.auth.uid);
    await db.collection('posts').add({
      uid: S.auth.uid,
      name, av: initials,
      bg: 'linear-gradient(135deg,#7c6fff,#ff6b8a)',
      avUrl: prof.avUrl||'',
      cap, dev, link, tutorial, download,
      cats: [...S.cats],
      files: [...S.mediaUrls],
      timeStr: now.toLocaleTimeString('id-ID',{hour:'2-digit',minute:'2-digit'}),
      likedBy: isOwnerUser ? [S.auth.uid] : [],
      commentsCount: 0,
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });

    // Reset form
    ['capInput','devInput','linkInput','tutorialInput','imgUrlInput','downloadInput'].forEach(id=>{
      const el=document.getElementById(id); if(el) el.value='';
    });
    document.getElementById('prevGrid').innerHTML='';
    document.getElementById('imgUrlPreview').style.display='none';
    document.querySelectorAll('.cat-chip').forEach(c=>c.classList.remove('sel'));
    S.mediaUrls=[]; S.cats=[];
    toast('Post berhasil!');
    setTimeout(()=>goPage('home','back'),700);
  } catch(e){
    toast('Gagal post: '+e.message);
  } finally {
    btn.innerHTML='<svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg> Posting Sekarang';
    btn.disabled=false;
  }
}

function toggleCat(el){el.classList.toggle('sel');const c=el.dataset.cat,i=S.cats.indexOf(c);i>-1?S.cats.splice(i,1):S.cats.push(c);}
const OWNER_UIDS = ['kYQi77AKzhf2712N3D7jwuPabOs2'];
const VERIFIED_UIDS = ['kYQi77AKzhf2712N3D7jwuPabOs2'];

function isOwner(uid){ return OWNER_UIDS.includes(uid); }
function isVerified(uid){ return VERIFIED_UIDS.includes(uid); }

function getBadge(uid){
  if(isOwner(uid)) return '<span class="badge owner" title="Owner">&#10003;</span>';
  if(isVerified(uid)) return '<span class="badge verified" title="Verified">&#10003;</span>';
  return '';
}


/* ‚ïê‚ïê CHAT ‚Äî Realtime Database ‚ïê‚ïê */
let chatRoomRef = null;
let chatRoomListener = null;

function renderChatList(){
  const onlineUsers = S.onlineUsers || {};
  const myUid = S.auth?.uid;
  const others = Object.entries(onlineUsers).filter(([uid])=>uid!==myUid);
  const onlineCount = Object.keys(onlineUsers).length;
  document.getElementById('onlineCountTxt').textContent = onlineCount > 0 ? `${onlineCount} user online` : 'Belum ada yang online';
  const list = document.getElementById('chatUserList');
  if(others.length === 0){
    list.innerHTML=`<div class="empty"><div class="empty-ico">üí¨</div><div class="empty-t">Belum ada user online</div><div class="empty-s">Saat ada user lain login, mereka akan muncul di sini.</div></div>`;
    return;
  }
  list.innerHTML = others.map(([uid, u])=>{
    const roomId = [myUid, uid].sort().join('_');
    const name = u.name || 'User';
    const initial = name[0].toUpperCase();
    const badge = getBadge(uid);
    return `<div class="chat-item" onclick="openRoom('${roomId}','${name}','${uid}')">
      <div class="ci-av" style="background:linear-gradient(135deg,var(--accent),var(--accent2));position:relative">
        ${initial}
        <div class="ci-online"></div>
      </div>
      <div class="ci-info">
        <div class="ci-name">${name}${badge}</div>
        <div class="ci-prev">Tap untuk mulai chat</div>
      </div>
    </div>`;
  }).join('');
}

function filterChats(v){}
function switchTab(el){document.querySelectorAll('.chat-tab').forEach(t=>t.classList.remove('active'));el.classList.add('active');}

function openRoom(roomId, name, otherUid){
  if(chatRoomListener){ rtdb.ref('messages/'+S.chatId)?.off(); }
  document.getElementById('crName').textContent = name;
  document.getElementById('crDot').style.background = 'var(--accent3)';
  document.getElementById('crStatusTxt').textContent = 'Online';
  const msgs = document.getElementById('crMsgs');
  msgs.innerHTML = `<div class="day-sep"><span>Hari ini</span></div>`;
  S.chatId = roomId;
  rtdb.ref('messages/'+roomId).limitToLast(50).on('child_added', snap=>{
    const m = snap.val();
    const isMe = m.uid === S.auth?.uid;
    const d = document.createElement('div');
    d.className = `msg-row ${isMe?'out':'in'}`;
    d.innerHTML = (!isMe?`<div class="msg-sender">${m.name||'User'}</div>`:'')+
      `<div class="msg-bub">${m.text}</div><div class="msg-time">${m.time||''}</div>`;
    msgs.appendChild(d);
    msgs.scrollTop = msgs.scrollHeight;
  });
  goPage('chatroom','forward');
}

document.getElementById('crInput').addEventListener('keydown',e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendMsg();}});

async function sendMsg(){
  const inp=document.getElementById('crInput'), txt=inp.value.trim();
  if(!txt||!S.auth||!S.chatId) return;
  const prof=S.profile;
  const name=[prof.first,prof.last].filter(Boolean).join(' ')||'User';
  const now=new Date().toLocaleTimeString('id-ID',{hour:'2-digit',minute:'2-digit'});
  inp.value='';
  await rtdb.ref('messages/'+S.chatId).push({
    uid: S.auth.uid, name, text:txt, time:now,
    ts: firebase.database.ServerValue.TIMESTAMP
  });
}

/* ‚ïê‚ïê COMMENTS ‚Äî Firestore ‚ïê‚ïê */
let cmtPostId = null;
let cmtListener = null;

function openComments(id){
  cmtPostId = id;
  if(cmtListener) cmtListener();
  const myAv = document.getElementById('cmtMyAv');
  if(S.profile.avUrl) myAv.innerHTML=`<img src="${S.profile.avUrl}">`;
  else { const n=[S.profile.first,S.profile.last].filter(Boolean).join(' ')||'Q'; myAv.textContent=n.split(' ').map(w=>w[0]).join('').slice(0,2).toUpperCase(); }
  const list=document.getElementById('cmtList');
  list.innerHTML=`<div class="cmt-empty"><div class="cmt-empty-ico">‚è≥</div><div class="cmt-empty-t">Memuat komentar...</div></div>`;
  cmtListener = db.collection('posts').doc(id).collection('comments')
    .orderBy('createdAt','asc').onSnapshot(snap=>{
      if(snap.empty){
        list.innerHTML=`<div class="cmt-empty"><div class="cmt-empty-ico">üí¨</div><div class="cmt-empty-t">Belum ada komentar. Jadilah yang pertama!</div></div>`;
        return;
      }
      list.innerHTML = snap.docs.map(d=>{
        const c=d.data();
        const avHTML=c.avUrl?`<img src="${c.avUrl}">`:(c.av||'?');
        return `<div class="cmt-item">
          <div class="cmt-av">${avHTML}</div>
          <div class="cmt-body">
            <div class="cmt-name">${c.name||'User'}</div>
            <div class="cmt-text">${c.text}</div>
            <div class="cmt-time">${c.timeStr||''}</div>
          </div>
        </div>`;
      }).join('');
      list.scrollTop=list.scrollHeight;
    });
  document.getElementById('cmtOverlay').classList.add('open');
  document.getElementById('cmtSheet').classList.add('open');
  setTimeout(()=>document.getElementById('cmtInput').focus(),400);
}

function closeComments(){
  document.getElementById('cmtOverlay').classList.remove('open');
  document.getElementById('cmtSheet').classList.remove('open');
  if(cmtListener){ cmtListener(); cmtListener=null; }
  cmtPostId=null;
}

async function sendComment(){
  const inp=document.getElementById('cmtInput');
  const txt=inp.value.trim(); if(!txt||!cmtPostId||!S.auth) return;
  const prof=S.profile;
  const name=[prof.first,prof.last].filter(Boolean).join(' ')||'User';
  const av=name.split(' ').map(w=>w[0]).join('').slice(0,2).toUpperCase()||'Q';
  inp.value='';
  const batch=db.batch();
  const cmtRef=db.collection('posts').doc(cmtPostId).collection('comments').doc();
  batch.set(cmtRef,{
    uid:S.auth.uid, name, av, avUrl:prof.avUrl||'', text:txt,
    timeStr:new Date().toLocaleTimeString('id-ID',{hour:'2-digit',minute:'2-digit'}),
    createdAt:firebase.firestore.FieldValue.serverTimestamp()
  });
  batch.update(db.collection('posts').doc(cmtPostId),{
    commentsCount:firebase.firestore.FieldValue.increment(1)
  });
  await batch.commit();
}

document.getElementById('cmtInput').addEventListener('keydown',e=>{if(e.key==='Enter')sendComment();});

/* ‚ïê‚ïê NOTIF ‚ïê‚ïê */
function renderNotifs(){
  const sub=document.getElementById('notifSubTxt');
  if(sub) sub.textContent='Semua sudah dibaca';
  const list=document.getElementById('notifList');
  if(list) list.innerHTML=`<div class="empty"><div class="empty-ico">üîî</div><div class="empty-t">Belum ada notifikasi</div><div class="empty-s">Saat ada yang like atau komentar, notif akan muncul di sini.</div></div>`;
}
function markAllRead(){ toast('‚úÖ Semua sudah dibaca'); }

/* ‚ïê‚ïê PROFILE ‚ïê‚ïê */
function renderProfile(){
  const p=S.profile;
  const name=[p.first,p.last].filter(Boolean).join(' ')||'Pengguna Baru';
  const handle=p.user?'@'+p.user.replace(/^@/,''):'@username';
  document.getElementById('profName').textContent=name;
  document.getElementById('profHandle').textContent=handle+(p.loc?' ¬∑ '+p.loc:'');
  document.getElementById('profBio').textContent=p.bio||'Belum ada bio.';
  const myPosts = S.posts.filter(post=>post.uid===S.auth?.uid);
  document.getElementById('statPosts').textContent=myPosts.length;

  // Badge
  const uid = S.auth?.uid;
  const badgeEl = document.getElementById('profBadges');
  if(badgeEl){
    if(isOwner(uid)) badgeEl.innerHTML=`<span class="prof-badge" style="background:rgba(29,155,240,.2);border-color:rgba(29,155,240,.5);color:#1d9bf0;font-weight:700">&#10003; Owner</span>`;
    else badgeEl.innerHTML=`<span class="prof-badge">Member</span>`;
  }

  // Avatar
  const av=document.getElementById('profAvInner');
  const ta=document.getElementById('topAvatar');
  if(p.avUrl){
    av.innerHTML=`<img src="${p.avUrl}" style="width:100%;height:100%;object-fit:cover;border-radius:inherit">`;
    ta.innerHTML=`<img src="${p.avUrl}" style="width:100%;height:100%;object-fit:cover;border-radius:inherit">`;
  } else {
    const init=name.split(' ').map(w=>w[0]).join('').slice(0,2).toUpperCase()||'?';
    av.textContent=init;
    ta.textContent=init[0]||'Q';
  }
  renderPostsWrap();
  updateFollowerCount();
}

function renderPostsWrap(){
  const wrap=document.getElementById('profPostsWrap'); if(!wrap) return;
  const myPosts = S.posts.filter(post=>post.uid===S.auth?.uid);
  if(myPosts.length===0){
    wrap.innerHTML=`<div class="empty" style="min-height:200px"><div class="empty-ico">üé®</div><div class="empty-t">Belum ada post</div><div class="empty-s">Postkan karya pertamamu!</div><button class="empty-btn" onclick="goPage('upload','forward')"><svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="3"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>Post Karya</button></div>`;
    return;
  }
  if(S.view==='grid'){
    const items = myPosts.flatMap(p=>(p.files||[]).map(f=>({f,p}))).slice(0,9);
    wrap.innerHTML=`<div class="prof-grid">${items.length>0?items.map(({f,p})=>f.type&&f.type.startsWith('video')?`<div class="pg-item" onclick="openBS('${p.id}')"><video src="${f.url}"></video></div>`:`<div class="pg-item" onclick="openBS('${p.id}')"><img src="${f.url}"></div>`).join(''):myPosts.slice(0,3).map(p=>`<div class="pg-item" style="background:var(--surface3)" onclick="openBS('${p.id}')"><div style="padding:8px;font-size:11px;color:var(--muted2);text-align:center">${(p.cap||'').slice(0,30)}</div></div>`).join('')}</div>`;
  } else {
    wrap.innerHTML=`<div class="prof-list">${myPosts.map((p,i)=>{const thumb=(p.files||[])[0]?(p.files[0].type&&p.files[0].type.startsWith('video')?`<video src="${p.files[0].url}"></video>`:`<img src="${p.files[0].url}">`):'';return `<div class="pl-item" style="animation-delay:${i*.04}s" onclick="openBS('${p.id}')"><div class="pl-thumb">${thumb||'üìù'}</div><div class="pl-info"><div class="pl-cap">${p.cap||'Post tanpa caption'}</div><div class="pl-meta">${p.timeStr||''} ¬∑ ${(p.likedBy||[]).length} suka</div></div></div>`;}).join('')}</div>`;
  }
}
function setView(v){S.view=v;document.getElementById('vtGrid').classList.toggle('active',v==='grid');document.getElementById('vtList').classList.toggle('active',v==='list');renderPostsWrap();}

/* ‚ïê‚ïê EDIT PROFILE ‚ïê‚ïê */
function loadEP(){
  const p=S.profile;
  document.getElementById('epFirst').value=p.first||''; document.getElementById('epLast').value=p.last||'';
  document.getElementById('epUser').value=p.user?'@'+p.user:''; document.getElementById('epBio').value=p.bio||'';
  document.getElementById('epLoc').value=p.loc||''; document.getElementById('epWeb').value=p.web||'';
  document.getElementById('epBioCount').textContent=(p.bio||'').length;
  const av=document.getElementById('epAvEl');
  if(p.avUrl){av.innerHTML=`<img src="${p.avUrl}"><div class="ep-av-overlay">üì∑</div>`;}
  else{const name=[p.first,p.last].filter(Boolean).join(' ')||'';const init=name?name.split(' ').map(w=>w[0]).join('').slice(0,2).toUpperCase():'üë§';av.innerHTML=`<span>${init}</span><div class="ep-av-overlay">üì∑</div>`;}
}
async function handleAvChange(inp){
  if(!inp.files[0]) return;
  const file = inp.files[0];
  const reader = new FileReader();
  reader.onload = async e => {
    const url = e.target.result;
    S.profile.avUrl = url;
    document.getElementById('epAvEl').innerHTML=`<img src="${url}"><div class="ep-av-overlay">Ganti</div>`;
    // Auto save to Firestore
    if(S.auth){
      await db.collection('users').doc(S.auth.uid).update({ avUrl: url });
      renderProfile();
    }
  };
  reader.readAsDataURL(file);
}
function fmtUser(inp){let v=inp.value.replace(/[^a-zA-Z0-9_.@]/g,'');if(v&&!v.startsWith('@'))v='@'+v;inp.value=v;}
async function saveProfile(){
  const fn=document.getElementById('epFirst').value.trim(); if(!fn){toast('Nama depan wajib diisi!');return;}
  S.profile.first=fn; S.profile.last=document.getElementById('epLast').value.trim();
  S.profile.user=document.getElementById('epUser').value.trim().replace(/^@/,'');
  S.profile.bio=document.getElementById('epBio').value.trim(); S.profile.loc=document.getElementById('epLoc').value.trim(); S.profile.web=document.getElementById('epWeb').value.trim();
  try {
    const uid = S.auth.uid;
    const name = [S.profile.first, S.profile.last].filter(Boolean).join(' ');
    const initials = name.split(' ').map(w=>w[0]).join('').slice(0,2).toUpperCase()||'?';
    // Update user profile
    await db.collection('users').doc(uid).update({
      first:S.profile.first, last:S.profile.last, user:S.profile.user,
      bio:S.profile.bio, loc:S.profile.loc, web:S.profile.web,
      avUrl:S.profile.avUrl||''
    });
    // Update nama di semua post milik user ini
    const posts = await db.collection('posts').where('uid','==',uid).get();
    const batch = db.batch();
    posts.forEach(doc=>{
      batch.update(doc.ref, { name, av: initials, avUrl: S.profile.avUrl||'' });
    });
    await batch.commit();
    toast('Profil disimpan!');
    renderProfile();
    setTimeout(()=>goBack(),600);
  } catch(e){ toast('Gagal simpan: '+e.message); }
}

function refreshFeed(btn){
  const icon = document.getElementById('refreshIcon');
  icon.style.animation = 'spin 0.6s linear';
  setTimeout(()=>icon.style.animation='', 700);
  loadPosts();
  toast('Feed diperbarui!');
}

let searchQuery = '';
function doSearch(val){
  searchQuery = val.toLowerCase().trim();
  renderFeed();
}

// Pull to refresh
let ptrStartY = 0, ptrPulling = false;
document.addEventListener('touchstart', e=>{
  const scroll = document.getElementById('homeScroll');
  if(scroll && scroll.scrollTop===0) { ptrStartY = e.touches[0].clientY; ptrPulling=true; }
}, {passive:true});
document.addEventListener('touchmove', e=>{
  if(!ptrPulling) return;
  const diff = e.touches[0].clientY - ptrStartY;
  if(diff > 60) document.getElementById('ptrIndicator').classList.add('show');
}, {passive:true});
document.addEventListener('touchend', e=>{
  if(!ptrPulling) return;
  ptrPulling = false;
  const ind = document.getElementById('ptrIndicator');
  if(ind.classList.contains('show')){
    ind.classList.remove('show');
    loadPosts();
    toast('Feed diperbarui!');
  }
});
async function deletePost(id){
  if(!confirm('Hapus postingan ini?')) return;
  try {
    await db.collection('posts').doc(id).delete();
    toast('Postingan dihapus!');
  } catch(e){ toast('Gagal hapus: '+e.message); }
}

/* ‚ïê‚ïê USER PROFILE MODAL + FOLLOW ‚ïê‚ïê */
async function viewUserProfile(uid, name, avUrl){
  if(uid === S.auth?.uid){ goPage('profile','forward'); return; }
  const overlay = document.getElementById('uprofOverlay');
  const sheet = document.getElementById('uprofSheet');
  const content = document.getElementById('uprofContent');
  content.innerHTML = `<div style="text-align:center;color:var(--muted2);padding:20px">Memuat...</div>`;
  overlay.classList.add('open'); sheet.classList.add('open');

  try {
    // Load user data
    const userDoc = await db.collection('users').doc(uid).get();
    const userData = userDoc.exists ? userDoc.data() : {first:name, last:'', bio:'', user:''};
    const fullName = [userData.first,userData.last].filter(Boolean).join(' ')||name;

    // Load user posts
    const postsSnap = await db.collection('posts').where('uid','==',uid).orderBy('createdAt','desc').limit(9).get();
    const userPosts = postsSnap.docs.map(d=>({id:d.id,...d.data()}));

    // Check follow status
    const myUid = S.auth?.uid;
    const followDoc = myUid ? await db.collection('follows').doc(`${myUid}_${uid}`).get() : null;
    const isFollowing = followDoc?.exists || false;

    // Get follower count
    const followersSnap = await db.collection('follows').where('targetUid','==',uid).get();
    const followerCount = followersSnap.size;

    const init = fullName.split(' ').map(w=>w[0]).join('').slice(0,2).toUpperCase()||'?';
    const avHTML = avUrl ? `<img src="${avUrl}" style="width:100%;height:100%;object-fit:cover;border-radius:50%">` : init;
    const badge = getBadge(uid);

    content.innerHTML = `
      <div style="display:flex;flex-direction:column;align-items:center;gap:12px;padding-bottom:16px">
        <div style="width:72px;height:72px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-size:22px;font-weight:800;color:#fff;overflow:hidden">${avHTML}</div>
        <div style="text-align:center">
          <div style="font-family:'Syne',sans-serif;font-size:18px;font-weight:800">${fullName}${badge}</div>
          ${userData.user?`<div style="color:var(--muted2);font-size:12px">@${userData.user}</div>`:''}
          ${userData.bio?`<div style="color:var(--muted2);font-size:12px;margin-top:4px">${userData.bio}</div>`:''}
        </div>
        <div style="display:flex;gap:24px;text-align:center">
          <div><div style="font-weight:700;font-size:16px">${userPosts.length}</div><div style="font-size:11px;color:var(--muted2)">Post</div></div>
          <div><div style="font-weight:700;font-size:16px" id="uprofFollowers">${followerCount}</div><div style="font-size:11px;color:var(--muted2)">Follower</div></div>
        </div>
        ${myUid && myUid!==uid ? `<button id="uprofFollowBtn" onclick="toggleFollow('${uid}','${fullName}')" style="background:${isFollowing?'var(--surface2)':'linear-gradient(135deg,var(--accent),var(--accent2))'};border:${isFollowing?'1px solid var(--border)':'none'};border-radius:10px;color:${isFollowing?'var(--muted2)':'#fff'};padding:9px 28px;font-size:13px;font-family:'DM Sans',sans-serif;font-weight:600;cursor:pointer">${isFollowing?'Mengikuti':'Ikuti'}</button>` : ''}
      </div>
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:3px;margin-top:8px">
        ${userPosts.flatMap(p=>(p.files||[]).slice(0,1)).slice(0,9).map(f=>
          `<div style="aspect-ratio:1;background:var(--surface2);border-radius:6px;overflow:hidden">
            <img src="${f.url}" style="width:100%;height:100%;object-fit:cover" onerror="this.style.display='none'">
          </div>`
        ).join('')}
        ${userPosts.length===0?`<div style="grid-column:1/-1;text-align:center;color:var(--muted2);padding:20px;font-size:12px">Belum ada post</div>`:''}
      </div>`;
  } catch(e){
    content.innerHTML = `<div style="text-align:center;color:var(--muted2)">Gagal memuat profil</div>`;
  }
}

function closeUserProfile(){
  document.getElementById('uprofOverlay').classList.remove('open');
  document.getElementById('uprofSheet').classList.remove('open');
}

async function toggleFollow(targetUid, targetName){
  const myUid = S.auth?.uid; if(!myUid) return;
  const followId = `${myUid}_${targetUid}`;
  const ref = db.collection('follows').doc(followId);
  const btn = document.getElementById('uprofFollowBtn');
  const counterEl = document.getElementById('uprofFollowers');
  const doc = await ref.get();
  if(doc.exists){
    await ref.delete();
    if(btn){ btn.textContent='Ikuti'; btn.style.background='linear-gradient(135deg,var(--accent),var(--accent2))'; btn.style.color='#fff'; btn.style.border='none'; }
    if(counterEl) counterEl.textContent = Math.max(0, parseInt(counterEl.textContent)-1);
    toast('Berhenti mengikuti '+targetName);
  } else {
    await ref.set({ followerUid:myUid, targetUid, targetName, followedAt: firebase.firestore.FieldValue.serverTimestamp() });
    if(btn){ btn.textContent='Mengikuti'; btn.style.background='var(--surface2)'; btn.style.color='var(--muted2)'; btn.style.border='1px solid var(--border)'; }
    if(counterEl) counterEl.textContent = parseInt(counterEl.textContent)+1;
    toast('Mengikuti '+targetName+'!');
  }
}

// Update renderProfile to show follower count
async function updateFollowerCount(){
  if(!S.auth) return;
  try {
    const followersSnap = await db.collection('follows').where('targetUid','==',S.auth.uid).get();
    const followingSnap = await db.collection('follows').where('followerUid','==',S.auth.uid).get();
    const fEl = document.getElementById('statFollowers');
    const fgEl = document.getElementById('statFollowing');
    if(fEl) fEl.textContent = followersSnap.size;
    if(fgEl) fgEl.textContent = followingSnap.size;
  } catch(e){}
}

function scrollToTop(){
  if(scroll) scroll.scrollTo({top:0, behavior:'smooth'});
  else window.scrollTo({top:0, behavior:'smooth'});
}

function openRandomPost(){
  if(S.posts.length===0){ toast('Belum ada post!'); return; }
  const random = S.posts[Math.floor(Math.random()*S.posts.length)];
  openBS(random.id);
}

let sidebarVisible = true;
function toggleSidebar(){
  sidebarVisible = !sidebarVisible;
  const sb = document.getElementById('mainSidebar');
  const showBtn = document.getElementById('sidebarShowBtn');
  const icon = document.getElementById('sidebarToggleIcon');
  sb.classList.toggle('collapsed', !sidebarVisible);
  showBtn.style.display = sidebarVisible ? 'none' : 'flex';
  if(icon) icon.innerHTML = sidebarVisible
    ? '<polyline points="15 18 9 12 15 6"/>'
    : '<polyline points="9 18 15 12 9 6"/>';
}

function toggleTheme(el){
  el.classList.toggle('on');
  const isLight = !el.classList.contains('on');
  document.body.classList.toggle('light', isLight);
  localStorage.setItem('qs_theme', isLight?'light':'dark');
  document.getElementById('themeIcon').textContent = isLight ? '‚òÄÔ∏è' : 'üåô';
  document.getElementById('themeLabel').textContent = isLight ? 'Mode Terang' : 'Mode Gelap';
}

// Load saved theme
const savedTheme = localStorage.getItem('qs_theme');
if(savedTheme==='light'){
  document.body.classList.add('light');
  setTimeout(()=>{
    const tog = document.getElementById('themeToggle');
    if(tog){ tog.classList.remove('on'); }
    const icon = document.getElementById('themeIcon');
    if(icon){ icon.textContent='‚òÄÔ∏è'; }
    const lbl = document.getElementById('themeLabel');
    if(lbl){ lbl.textContent='Mode Terang'; }
  }, 500);
}

function toggleSwitch(el){el.classList.toggle('on');}

/* ‚ïê‚ïê TOAST ‚ïê‚ïê */
let toastT;
function toast(msg){
  document.querySelector('.toast')?.remove();
  const t=document.createElement('div'); t.className='toast'; t.textContent=msg;
  document.body.appendChild(t); clearTimeout(toastT);
  toastT=setTimeout(()=>{t.classList.add('out');setTimeout(()=>t.remove(),220);},2400);
}
</script>
</body>
</html>
